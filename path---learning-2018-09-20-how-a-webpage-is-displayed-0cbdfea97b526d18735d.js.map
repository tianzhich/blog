{"version":3,"sources":["webpack:///path---learning-2018-09-20-how-a-webpage-is-displayed-0cbdfea97b526d18735d.js","webpack:///./.cache/json/learning-2018-09-20-how-a-webpage-is-displayed.json"],"names":["webpackJsonp","286","module","exports","data","markdownRemark","html","frontmatter","title","date","excerpt","contents","text","subContents","pathContext","slug"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,gBAAkBC,KAAA;AAA8glFC,aAAu4EC,MAAA,kBAAAC,KAAA,qBAAAC,QAAA,wDAAAC,WAAqIC,KAAA,KAAAC,YAAA,OAAiCD,KAAA,0BAAAC,YAAA,OAAsDD,KAAA,QAAAC,YAAA,OAAoCD,KAAA,UAAAC,YAAA,OAAsCD,KAAA,gBAAAC,cAAuCD,KAAA,uBAA8BA,KAAA,SAAAC,YAAA,OAAqCD,KAAA,QAAAC,YAAA,OAAoCD,KAAA,eAAAC,YAAA,OAA2CD,KAAA,0BAAAC,cAAiDD,KAAA,WAAkBA,KAAA,cAAqBA,KAAA,WAAkBA,KAAA,mBAA0BA,KAAA,yBAAgCA,KAAA,KAAAC,YAAA,OAAiCD,KAAA,KAAAC,YAAA,UAAmCC,aAAgBC,KAAA","file":"path---learning-2018-09-20-how-a-webpage-is-displayed-0cbdfea97b526d18735d.js","sourcesContent":["webpackJsonp([224058518057538],{\n\n/***/ 286:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<h2 id=\\\"前言\\\"><a href=\\\"#%E5%89%8D%E8%A8%80\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>前言</h2>\\n<p>回顾自己的前端学习历程，现在都还不能深入理解浏览器对HTML文档的解析和渲染过程。最近被问到HTML的重绘(Repaint)和重排(Reflow)，才想起自己根本没仔细研究过它。</p>\\n<p>作为前端工程师，我们每天写HTML，CSS和JavaScript，但是浏览器是如何解析这些文件，最终将它们以像素显示在屏幕上的呢？</p>\\n<p>这一过程叫做<em>Critical Rendering Path</em></p>\\n<h2 id=\\\"critical-rendering-path\\\"><a href=\\\"#critical-rendering-path\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Critical Rendering Path</h2>\\n<p><em>Critical Rendering Path</em>，中文翻译过来，叫做<strong>关键渲染路径</strong>。指的是浏览器从请求HTML，CSS，JavaScript文件开始，到将它们最终以像素输出到屏幕上这一过程。包括以下几个部分</p>\\n<ol>\\n<li>\\n<p>构建DOM</p>\\n<ul>\\n<li>将HTML解析成许多Tokens</li>\\n<li>将Tokens解析成object</li>\\n<li>将object组合成为一个DOM树</li>\\n</ul>\\n</li>\\n<li>\\n<p>构建CSSOM</p>\\n<ul>\\n<li>解析CSS文件，并构建出一个CSSOM树（过程类似于DOM构建）</li>\\n</ul>\\n</li>\\n<li>\\n<p>构建Render Tree</p>\\n<ul>\\n<li>结合DOM和CSSOM构建出一颗Render树</li>\\n</ul>\\n</li>\\n<li>\\n<p>Layout</p>\\n<ul>\\n<li>计算出元素相对于viewport的相对位置</li>\\n</ul>\\n</li>\\n<li>\\n<p>Paint</p>\\n<ul>\\n<li>将render tree转换成像素，显示在屏幕上</li>\\n</ul>\\n</li>\\n</ol>\\n<p>值得注意的是，上面的过程并不是依次进行的，而是存在一定交叉，后面会详细解释</p>\\n<p>想要提高网页加载速度，提升用户体验，就需要在第一次加载时让重要的元素尽快显示在屏幕上。而不是等所有元素全部准备就绪再显示，下面一幅图说明了这两种方式的差异</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-a5e4a.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 611px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 49.09983633387889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACo0lEQVQoz1WSXUhTYRjHJyIr2xBhyMCbMCfUSitF14V4oWBeSAwsgvBidzovLLrprsvQqwnRB3URoc2EGqarNe3s0OY8uraxue+PZM61763tzJ325el5RgY+8HJ+73ve83//z/89nAaotra2Bg6UQqFoHhoaunxzdLTj3YqK23XleufF7l7x3MKLMyLx1fOdl3p6Ju7JeGPSu63Iw2O3Wu8/eszr7rshHhgcbp+4faeu8798Pt/LUqnE5vP50DeC0FAmC/19i2LW1Z+R9427lupH1apux2QObZusVY12cxtebZMGqmKkTJHJycleDhjsEAqFF0CPm0ql3rBQtVot5/V6DcgFmmZdLpehWq1mcW6320yl0p/fyAehkMNqsTgy6TRL0/mj2dnZfjQmaWlpkcCzPRqNLuJG+Djvdru32H+FnMlk6iJ7e3s/YrFYDjkYDDoDgYATDLDpdLo4NTXVX3coEAhEIHgWNi4cHx9XoG2fw+FYLZfLSRhZZIZhPGgY3H61Wq1ej8dTgIN0ZrNZBxM6Fo0GZ2Zmrp3KkCTJB/ABabPZlGtra0/sdvs6jC/IsLYEIptqtXrOaDQuudzuDYNB/+ztovKpal2j/aTWrIyPj4s4jY2N50ZGRngoGA6Hl7EVcMg4nc6dk5aRYe0IGUSpbDZbQE7E4wc6HRn4uR9i/YFgZXp6egB1Bvl8/iBmGI/HX+PGSqUSh3YIyKYKEWCGBKxF8R38CUQul/tVF0wknB6P21oo0CzDFNPQch+nqamJK5VKm1E5mUwqcSOIlOCWTScOkUGcQYZL2KVpuogMf0UYIgpCzizkX5PL5ZJTGUJOD8Gl4fDwcEWv189HIhENjA1kWHsPB5KQ37zf718GJiCKV1qt9jlFUQQc+kEmk3X9BYHqF7qoGS41AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"progressive rendering\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-a5e4a.png\\\"\\n        srcset=\\\"/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-b200a.png 213w,\\n/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-d4624.png 425w,\\n/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-a5e4a.png 611w\\\"\\n        sizes=\\\"(max-width: 611px) 100vw, 611px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"构建dom\\\"><a href=\\\"#%E6%9E%84%E5%BB%BAdom\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>构建DOM</h2>\\n<p><em>DOM (Document Object Model)</em>，文档对象模型，构建DOM是必不可少的一环，浏览器从发出请求开始到得到HTML文件后，第一件事就是解析HTML成许多Tokens，再将Tokens转换成object，最后将object组合成一颗DOM树</p>\\n<p>这个过程是一个循序渐进的过程，我们假设HTML文件很大，一个<em>RTT (Round-Trip Time)</em>只能得到一部分，浏览器得到这部分之后就会开始构建DOM，并不会等到整个文档就位才开始渲染。这样做可以加快构建过程，而且由于自顶向下构建，因此后面构建的不会对前面的造成影响</p>\\n<p>后面我们将会提到，CSSOM则必须等到所有字节收到才开始构建</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-f06f1.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 55.38735529830811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADTUlEQVQoz2NgmhPcyDDdbwXDZJ/FDAuC5/Fl2+uJMbBJiMhIyggKCSmIiYlLqalr8IOwhqYWn5KyioCWtg4viK2qps6vqaXNp6ikLGhqZsH9//9/Rob+Q7squvdunde+bf3cicf2TamYM1WFgYGBy9HBWsDCRI/PSFeD38PFjtvZ3pLHzcGS28vFhtvV3pIbxPZwtuEO8nbmPLtnOcvW5VNZVi+dycxw8cbLkiOnb8/cvu/MzKt33vUtWL5FNyQiVCUqIU05IS1LMSYxUTMwLFY5MiZGPSIuUd0/NFo9PDpKKzA8Ti08OkYjKT1TZcexS4L7jx0SPXHmPDfDrsufKrdfeDd//bHH8/de/967dN+DhDm7npevOPo2e+Geh+Vz97zOP3ztc/6KY99TFu6+V7vmxPviGdue5q099qxm3r4PmXN3PipZBRRbceJ33slbf9wYXp0vL390vHDu9X05c95fKuu/cLDd6uqB8t5zh3ocz+xrCbi4t6xl34lTElcOVNaf3tMQfPzADKPL+8u79u6er3HnRF3pzWMNqRePTXK4fqhi7q2T3VYMb04lVz4/Gj//zp7YeR/PJk25uidf887x2oALh3plrh9tVbt7vDJg3dZ9bHeOV/vcO15pf+tIpcmto1Wxh/bMErx7ss7p7slG88tHOpRuHKkJPbW/R4Lh4/n0mnenkxc9OZww79ul9Nl39qfJAyOF4c6+DO4ru3P4Qexpyw+wgeiz+5vybxwuX8WAD6gaRTIe2TmL8f//24yWLkmM/0/qMO49uIzzyqHqwhuHy+Yt3bBUjcHkIFP3ikPcFw825t88UtYu3PCflYHhP+ODU9W8b87nsYPMeXY6nfHxuRiEwXlhQCX/IexbR8qqQQbeOtHgdu9E9ZJdR05r3D3ZMPHm8dqmhPn/eRZsOCc9f88z0ZtHq1Y8OFWZDdLz/VIy44kD0xgYnhxJY3h1MpXh5cl0hlfHY8EGXjtQxProbC/Y5ou3nkefvPp6/plTm4qv7CtccebCuZpDZx8vOXfzucndo3l9t49Xp4LUfTobx3jmUB9mELzfrQ9nz2n1hoj9/8916vLjhcfP3th2/OKjCmCOYAKJ3zjRzbx7fSUj2BG7k4DkfwYAkmqPY+PyWEUAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"full process\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-8d63b.png\\\"\\n        srcset=\\\"/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-16ce1.png 213w,\\n/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-898e7.png 425w,\\n/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-8d63b.png 850w,\\n/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-f06f1.png 1123w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"构建cssom\\\"><a href=\\\"#%E6%9E%84%E5%BB%BAcssom\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>构建CSSOM</h2>\\n<p><em>CSSOM (CSS Object Model)</em>，CSS对象模型，构建过程类似DOM，当HTML解析中遇到<code class=\\\"language-text\\\">&lt;link&gt;</code>标签时，会请求对应的CSS文件，当CSS文件就位时，便开始解析它（如果遇到行内<code class=\\\"language-text\\\">&lt;style&gt;</code>时则直接解析），这一解析过程可以和构建DOM同时进行</p>\\n<p>假设有如下CSS代码</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"css\\\">\\n      <pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\">body</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">font-size</span><span class=\\\"token punctuation\\\">:</span> 16px <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">p</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">font-weight</span><span class=\\\"token punctuation\\\">:</span> bold <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">span</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">color</span><span class=\\\"token punctuation\\\">:</span> red <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">p span</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">display</span><span class=\\\"token punctuation\\\">:</span> none <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">img</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">float</span><span class=\\\"token punctuation\\\">:</span> right <span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>构建出来的CSSOM是这样的</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-5a622.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 582px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 51.37457044673539%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACrElEQVQoz41SXUhTARS+booQ4UvZS9BDP1BQ0EMEQUHUS2FED4GRD4mkLKNRkssphT9kiYtS8KHQoh/oJSqNWTqVdd3mdbt/2737u7t3273uz825ueZw8+e0zepFH/rgwDmHw3fOd85BkDxIbvEWwfieUw6ph2B9Gto1N/QVh2OemZbTQUvTsGi6PRYg2jr1EwPlAAgCUF6C/AEk98siWH2pH2+XX3qysJm08fEJFy8BbuXSs5TbjdmCM+pxOPFFO3QhgClxVqcQveb290gllP8lOqSGUmQ7kHZJphndKJ3JwA4AkOetRMRbqgRM3Uugva1a/eieQt2ZbjhAor1Kj1H1CEdf1Ff3r1SO6j6epdHuN7yxeVAkumqbP6yVbWlw8qamIkyqyCVKkUxY70Voo+ZiIe/Eus7NWxQBYarmV5JW0AOD93dGyLuXo5aGORGtXYxSytdFApMjdYVwhNQmJtqixaI900zi8VsDHJ+efFaj1/W99M22NeBTrXtHLHB4Eg91fMd8AwZbrGnMsnDtJ5O5qqcT/eNksh93JjoMzMJ1hPGEjdnsCgSCIQhHIrCaywLBxTpjROM3aboOYoQSGFRVzfhX2/LrAEHwQnYlAywfWfJIcSyXzYAk+mF1bR1YIW5AzM64ysGHDDjj+4RZxfYxI1ffNw67CtMrB9CD++5IFQXfwi1XCVKMIu3iZ8wmPpywpqus3nQj54+N5BU+RalgtZnPHd2yw2E77LZ745N2bk5nsYenKGfwh0sImRhv6gHyP7B7gjLWRspIq7N4IVpYPrVRkMZzIPoFCIUCBaUghVNo8e/AVobTTrk3sCiTIilZUPLJPW6HzMV55WZ3WvaPmOKXioHeljriDyXnWacQp1leIFlBy3Dhd7SQvrFJOF9S9yqHnO9e33bA37RPvRr/HVl2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"cssom tree\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-5a622.png\\\"\\n        srcset=\\\"/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-f1daf.png 213w,\\n/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-a4e18.png 425w,\\n/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-5a622.png 582w\\\"\\n        sizes=\\\"(max-width: 582px) 100vw, 582px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>需要注意的是，上面并不是一颗完整的CSSOM树，文档有一些默认的CSS样式，称作<em>user agent styles</em>，上面只展示了我们覆盖的部分</p>\\n<p>CSSOM的构建必须要获得一份完整的CSS文件，而不像DOM的构建是一个循序渐进的过程。因为我们知道，CSS文件中包含大量的样式，后面的样式会覆盖前面的样式，如果我们提前就构建CSSOM，可能会得到错误的结果</p>\\n<h2 id=\\\"构建render-tree\\\"><a href=\\\"#%E6%9E%84%E5%BB%BArender-tree\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>构建Render Tree</h2>\\n<p>这也是关键的一步，浏览器使用DOM和CSSOM构建出Render Tree。此时不像构建DOM一样把所有节点构建出来，浏览器只构建需要在屏幕上显示的部分，因此像<code class=\\\"language-text\\\">&lt;head&gt;</code>,<code class=\\\"language-text\\\">&lt;meta&gt;</code>这些标签就无需构建了。同时，对于<code class=\\\"language-text\\\">display: none</code>的元素，也无需构建</p>\\n<blockquote>\\n<p><code class=\\\"language-text\\\">display: none</code>告诉浏览器这个元素无需出现在Render Tree中，但是<code class=\\\"language-text\\\">visibility: hidden</code>只是隐藏了这个元素，但是元素还占空间，会影响到后面的<strong>Layout</strong>，因此仍然需要出现在Render Tree中</p>\\n</blockquote>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-c2ada.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 46.69565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACkUlEQVQoz3VQXUhTYRg+001tztLSwixoppSplDdelBQEsatuwwwUE6YozAqdM1D8I0mtTApTFywbiznNLFEcOrdz9uPOjmc7PztnZ39u07RA6yqii/jaWVHe9MAHz/N+Dw/v+0BQHAC4BVkHU3Jyz1xO5zVu6ZX5rO0T3PqzhP7tAYKKK9dOV966fYrXu2hNKojeT4H24wdIOCEGbm9jbN0K6C5I5ufI8uNKerVlfHxGGw8ECa+L3Sslue0pgo0NG+zfyiizUkmYOxR5w0CkGJwQbTrlkoTRh6juUGZVtxfpGCRsIwrW+aQm5Ggb085O5T6dB8dsFrUsaFfqvdgrqRn/cvwdEivkHN1qn1VZu2p8fpW09BgQWCcj4D4d4dRcgkJIczrQQAI3w+a56M2XTg/Z7lntnHOg8AOE2Bum1meqA5b6IdqLXcfIoNdFbqy50ekBEu7ReP3Rt5jHSxD+T2o3ydpRcmPxz/Gtgt14Rzyzu6N1iIt7bXayjfvraenXp1mxQMkyGj2P06EVxzpDod6dnvIGTjhv8WW+hyN5k/oFMdR6ryGpqbE+taS4KDM/X3r4YvmFND5A88acYYSJE7oP2JGFJeshF+Y+Fx8n8X8vpqmjI2pDZpwmF0glwsKTEmGcC8pKC4T7l8iIvyyR+IBwfgeI6dDnUSb4cdZBblUTvrAsEt1SU7GfUspULQGROjH0P1RVVUFyufyvXqTDBSs47FlCTYTWFr0ZRnu7IliXTrsSySkaBaLwmkobQ9se5ZtAsoVjs5doLnvShCc27+wf+Bd8o7Y20eEc7hevBYkKI02fpQI7Q24mOob7tvtcZFCP+r8XbzqaHkbszSojE1SYcDNjIp0GfPcrfx1kDbDQL+2RTlz0GRJmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"render tree construction\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-8d63b.png\\\"\\n        srcset=\\\"/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-16ce1.png 213w,\\n/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-898e7.png 425w,\\n/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-8d63b.png 850w,\\n/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-c2ada.png 1150w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>构建过程遵循以下步骤</p>\\n<ol>\\n<li>浏览器从DOM树开始，遍历每一个“可见”节点</li>\\n<li>对于每一个\\\"可见\\\"节点，在CSSOM上找到匹配的样式并应用</li>\\n<li>生成Render Tree</li>\\n</ol>\\n<h3 id=\\\"扩展：css匹配规则为何从右向左\\\"><a href=\\\"#%E6%89%A9%E5%B1%95%EF%BC%9Acss%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%E4%B8%BA%E4%BD%95%E4%BB%8E%E5%8F%B3%E5%90%91%E5%B7%A6\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>扩展：CSS匹配规则为何从右向左</h3>\\n<p>相信大多数初学者都会认为CSS匹配是左向右的，其实恰恰相反。学习了CRP，也就不难理解为什么了。</p>\\n<p>CSS匹配就发生在Render Tree构建时（Chrome Dev Tools里叫做<em>Recalculate Style</em>），此时浏览器构建出了DOM，而且拿到了CSS样式，此时要做的就是把样式跟DOM上的节点对应上，浏览器为了提高性能需要做的就是快速匹配</p>\\n<p>首先要明确一点，浏览器此时是给一个\\\"可见\\\"节点找对应的规则，这和jQuery选择器不同，后者是使用一个规则去找对应的节点，这样从左到右或许更快。但是对于前者，由于CSS的庞大，一个CSS文件中或许有上千条规则，而且对于当前节点来说，大多数规则是匹配不上的，到此为止，稍微想一下就知道，如果从右开始匹配（也是从更精确的位置开始），能更快排除不合适的大部分节点，而如果从左开始，只有深入了才会发现匹配失败，如果大部分规则层级都比较深，就比较浪费资源了</p>\\n<p>除了上面这点，我们前面还提到DOM构建是\\\"循序渐进的\\\"，而且DOM不阻塞Render Tree构建（只有CSSOM阻塞），这样也是为了能让页面更早有元素呈现。考虑如下情况，如果我们此时构建的只是部分DOM，而此时CSSOM构建完成，浏览器此时需要构建Render Tree，如果对每一个节点，找到一条规则进行从左向右匹配，则必须要求其子元素甚至孙子元素都在DOM上（而此时DOM未构建完成），显然会匹配失败。如果反过来，我们只需要查找该元素的父元素或祖先元素（它们肯定在当前DOM中）</p>\\n<h2 id=\\\"layout\\\"><a href=\\\"#layout\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Layout</h2>\\n<p>我们现在为止已经得到了所有元素的自身信息，但是还不知道它们相对于Viewport的位置和大小，Layout这一过程需要计算的就是这两个信息</p>\\n<p>根据这两个信息，Layout输出元素的<em>Box Model</em>，关于这个，我也写过一篇文章<a href=\\\"https://tianzhich.github.io/blog/learning/2018/09/11/Document-Flow-and-the-CSS-Positioning/\\\"><em>Understand CSS Formatting Model</em></a></p>\\n<p>目前为止，现在我们已经拿到了元素相对于Viewport的详细信息，所有的值都已经计算为相对Viewport的精确像素大小和位置，就差显示了</p>\\n<h2 id=\\\"paint\\\"><a href=\\\"#paint\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Paint</h2>\\n<p>浏览器将每一个节点以像素显示在屏幕上，最终我们看到页面</p>\\n<p>这一过程需要的时间与文档大小，CSS应用样式的多少以及复杂度，还有设备自身都有关，例如对简单的颜色进行Paint是简单的，但是<code class=\\\"language-text\\\">box-shadow</code>进行paint则是复杂的</p>\\n<h2 id=\\\"引入javascript\\\"><a href=\\\"#%E5%BC%95%E5%85%A5javascript\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>引入JavaScript</h2>\\n<p>前面的过程都没有提到JavaScript，但在如今，JavaScript却是网页中不可缺的一部分。这里对它如何影响CRP做一个概要，具体细节我后面使用Chrome Dev Tools进行了测验</p>\\n<ol>\\n<li>解析HTML构建DOM时，遇到JavaScript会被阻塞</li>\\n<li>JavaScript执行会被CSSOM构建阻塞，也就是说，JavaScript必须等到CSS解析完成后才会执行（这只针对在头部放置<code class=\\\"language-text\\\">&lt;style&gt;</code>和<code class=\\\"language-text\\\">&lt;link&gt;</code>的情况，如果放在尾部，浏览器刚开始会使用<em>User Agent Style</em>构建CSSOM）</li>\\n<li>如果使用异步脚本，脚本的网络请求优先级降低，且网络请求期间不阻塞DOM构建，直到请求完成才开始执行脚本</li>\\n</ol>\\n<h2 id=\\\"使用chrome-dev-tools检测crp\\\"><a href=\\\"#%E4%BD%BF%E7%94%A8chrome-dev-tools%E6%A3%80%E6%B5%8Bcrp\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>使用Chrome Dev Tools检测CRP</h2>\\n<p>为了模拟真实网络情况，我把Demo部署到了我的<a href=\\\"https://tianzhich.github.io/Critical-Rendering-Path-Demo/\\\">githubpage</a>，你也可以在仓库找到<a href=\\\"https://github.com/tianzhich/Critical-Rendering-Path-Demo\\\">源代码</a></p>\\n<p><strong>同时，不要混淆DOM, CSSOM, Render Tree这三个概念，我刚开始就容易混淆DOM和Render Tree，这两个是不同的</strong></p>\\n<p><strong>下面的Chrome截图部分，如果不清晰，请直接点击图片查看原图</strong></p>\\n<h3 id=\\\"0-代码部分\\\"><a href=\\\"#0-%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>0. 代码部分</h3>\\n<h4 id=\\\"html\\\"><a href=\\\"#html\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>HTML</h4>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"html\\\">\\n      <pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>html</span><span class=\\\"token punctuation\\\">></span></span>\\n  \\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">charset</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>UTF-8<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">name</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>viewport<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">content</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>width=device-width, initial-scale=1.0<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>link</span> <span class=\\\"token attr-name\\\">rel</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>stylesheet<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>../css/main.css<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token punctuation\\\">/></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>title</span><span class=\\\"token punctuation\\\">></span></span>Critical Rendering Path with separate script file<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>title</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>What's up? <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>span</span><span class=\\\"token punctuation\\\">></span></span>Bros. <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>span</span><span class=\\\"token punctuation\\\">></span></span>My name is tianzhich<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>div</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>img</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>../images/xiaoshuang.jpg<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">alt</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>小爽-流星雨<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">height</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>500<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>script</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>../js/main.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script language-javascript\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n  \\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>html</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<h4 id=\\\"javascript\\\"><a href=\\\"#javascript\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>JavaScript</h4>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"javascript\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">var</span> span <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getElementsByTagName</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'span'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\nspan<span class=\\\"token punctuation\\\">.</span>textContent <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'Girls. '</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// change DOM text content</span>\\nspan<span class=\\\"token punctuation\\\">.</span>style<span class=\\\"token punctuation\\\">.</span>display <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'inline'</span><span class=\\\"token punctuation\\\">;</span>  <span class=\\\"token comment\\\">// change CSSOM property</span>\\n\\n<span class=\\\"token comment\\\">// create a new element, style it, and append it to the DOM</span>\\n<span class=\\\"token keyword\\\">var</span> loadTime <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nloadTime<span class=\\\"token punctuation\\\">.</span>textContent <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'You loaded this page on: '</span> <span class=\\\"token operator\\\">+</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nloadTime<span class=\\\"token punctuation\\\">.</span>style<span class=\\\"token punctuation\\\">.</span>color <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'blue'</span><span class=\\\"token punctuation\\\">;</span>\\ndocument<span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>loadTime<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<h4 id=\\\"css\\\"><a href=\\\"#css\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>CSS</h4>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"css\\\">\\n      <pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token comment\\\">/* // [START full] */</span>\\n<span class=\\\"token selector\\\">body</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">font-size</span><span class=\\\"token punctuation\\\">:</span> 16px\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">p</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">font-weight</span><span class=\\\"token punctuation\\\">:</span> bold\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">span</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">color</span><span class=\\\"token punctuation\\\">:</span> red\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">p span</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">display</span><span class=\\\"token punctuation\\\">:</span> none\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">img</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">float</span><span class=\\\"token punctuation\\\">:</span> right\\n<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token comment\\\">/* // [END full] */</span></code></pre>\\n      </div>\\n<h3 id=\\\"1-不加载js情况\\\"><a href=\\\"#1-%E4%B8%8D%E5%8A%A0%E8%BD%BDjs%E6%83%85%E5%86%B5\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>1. 不加载JS情况</h3>\\n<p>首先来看没有加载JS的情况</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACmElEQVQ4y5WTyW7TUBSGvUViUzWhNKoQEumWp2DVICGxg7DghTALHgVBM0ggKjopdkho7STN5NmJE89jbpJ7uHYqRAtdcKRPZ7o6Prb/SzXrn/c5jnnf6XVpnufpbrdDc50u3Wy1aZZlaZZh6GazSbdaLZrjOJrneHo0GtGSJNGiKGaQ+J0gCB8YhnlK1WrVF57vQhhF4HsehGEIjh+B7Xrguk6WZ5B+slhAFMcQE5IkIWziOI4AMIZ6vf6W+lStHYzHElaGfTRs/0DiVQ8poojGlxdIHfSRLClIUXVSk5HQ6SJVkJE+mSFVnSJN+02iaROoVCqvqAbTKCVhAEvTwEiXMRIHMP3ZBPn0CGbEe/0eWEMOxKtTaB9/hD53BKLQBGHMbrzAYnHErNaJD1y3W6ZqX09Kpu2B7QV4YnpY002YGTOYzy1wbJd8Bh9sy4UJqVm+DZqlgU4YKAOQDQnUuYK1ubJyIw++HX8vU5WjVilYAPgJYHHqYVGzQJt5aQ52sMxiw45hRpiaAVgugngJMLUimDsJGGaE3RCvMAAwbLtMHX45Kc2d9GCILS/Grh+DHy4giNBfpHU/2pDlmxiT+iqd2GpflKkGy5YM0wbP87Bt2zgIAvLDMKxWK1jfZn3NnzkZtU4DYpeXl2WK57gSQgiiKMKKqmIyGP7T0rfNBvJ8h2zYaBykWiJaWzuOsyaDbxDfyu9gSbYEIv7X1NnZ2fOACDdJFrBY3CR7UBSn218L+d+k51I7Pz9/Qx0eVp51elemLMuGLEmGqqqGrusZoiAY/eHYGI5GRtZXlI2/haIoE3L9vGq1+pLK5R/ce/xo70k+l9vP5XLF7e3t4tbWVsbOzk5xr/CwWNjdJfVN7y7y+XyxUCjc/wWNdm5DH/XtDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-16ce1.png 213w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-898e7.png 425w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png 850w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-c39de.png 1275w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-12da9.png 1700w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-894f8.png 2550w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>上图中，浏览器收到HTML文件后，便开始解析构建DOM。</p>\\n<p><strong>需要注意，上图接收的只是图片的一部分</strong></p>\\n<p>接下来我们详细看看这三个部分</p>\\n<h4 id=\\\"dom构建体现为parse-html\\\"><a href=\\\"#dom%E6%9E%84%E5%BB%BA%E4%BD%93%E7%8E%B0%E4%B8%BAparse-html\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>DOM构建(体现为parse html)</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACe0lEQVQ4y5WTSW/TUBCAfUXiQmhDSMWJ9Mqv4NQgIXGDcOAPYQ78FA5JAwIKNAk0Tt00a3FSL4mTOkvrxPvyhnkvlqhAquDJn2bV2J55wzU+FHc7HeFNt9/jO50O3+v1+Ha3xx+LJ7wgCLxQr/ONRoMXRZHFKcPhkFdVlVcUhYH6a1mW39br9UdcqVh8enm5BNuxwTRNsG0LrtYOLK5WiW2D4zgM13UZnueB7/sMqlPoKZfLr7h3xf29fl8imjYKFEUNVE0LFFUNqL3RNZSjRGqBnOTIisJ06kfpjcc6Fnz/nBOEej4OfaxPSAI+IdoxEqEIroH+KNjEWE5IJcFYRL8Q21Hgyp8q+WNpBofdC3IoyqTSHEHl7BK+tg04ak9AOLegIVtwrNiYM4ODpg7VEwWE/gJq/TUcSRYRZCcaziOoVqsFbv+LmJ+vCUzNiJyrMzJQDNDNGKSJBdJAh/EyAAPjF6uY5sD0KgRF1uG0qUBNuICBZBJj7kRrbKMgnha44sdafmnaOBSXWI5PbNcHxw3A9iLw8W9cLwTHCxhUp9gUzHPZUHziOn4UY6fEZqvAfa58z0+MOZgri4RhSIEoijZc168RJyQ2ieOY9bDVwoInwo/8bG7CwvSI63msIMHZ/AdU/B7Kt4P6Xq21hL5ux7PpJF4slnS8MWbFyaj/BTpy6Ha7L7jD2tGTtmbDwmIv+ePgjcDmxPQ23XBIEsdtesmVSqXHkvRzMR5pBq6QMRqNDF3XGbJ8bpxJQ2MwGBoaxjRN+wt145/iCq6w1jMudTd9615m5+Gd1Nbu9vZ2bmtrK5dKpRiZTCb3YOd+biebZf6bSKfTuWw2e/sXqG5x/MfO0xkAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script2\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-16ce1.png 213w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-898e7.png 425w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-8d63b.png 850w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-c39de.png 1275w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-12da9.png 1700w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-894f8.png 2550w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>可以看出，浏览器解析到<code class=\\\"language-text\\\">&lt;link&gt;</code>，<code class=\\\"language-text\\\">&lt;img&gt;</code>等等标签时，会马上发出HTTP请求，而且解析也将继续进行，解析完成后会触发<a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState\\\">readystatechange</a>事件和<a href=\\\"https://developer.mozilla.org/en-US/docs/Web/Events/DOMContentLoaded\\\">DOMContentLoaded</a>事件，在上图中，由于时间间隔已经到了100微秒级别，事件间隔有些许差异，但不影响我们对这一过程的理解</p>\\n<p>细心的话可能会注意到上图中还触发了Recalculate Style (紫色部分)，这一过程发生在CSSOM树构建完成或者发生变化需要更新Render Tree时，但是此时我们并没有拿到CSS，更没有构建出CSSOM，这一部分从何而来呢？我在下面第4部分做了分析</p>\\n<h4 id=\\\"页面首次出现画面\\\"><a href=\\\"#%E9%A1%B5%E9%9D%A2%E9%A6%96%E6%AC%A1%E5%87%BA%E7%8E%B0%E7%94%BB%E9%9D%A2\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>页面首次出现画面</h4>\\n<p>下面这一过程依次展示了CSS解析构建CSSOM，Render Tree生成，layout和paint，最终页面首次出现画面</p>\\n<p>下图中有一点错误：<strong>render tree构建应该发生在Recalculate Style (layout前一部分)，Layout以及后一部分Update Layer Tree作为Layout</strong></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACnElEQVQ4y3WTzW7TQBDHfUXiUjWhNKoQEumVp+DUICFxg3DghXAPvAQSJySUkFRC0AqIQhJSQdK0SdzE33bs+GNtx3GTHcbbBpVAV/ppZuc/O7tez3Ktg/Jup9vcPznt8d1ul+/1enznpMe32sd8s9nkm40G32q1+Ha7zfQUQRB4URT58XjMQP/VaDR63Wg0HnKVSvmJ49oQhiF4ngdBEIDjB2C5Hriuy+apFkYhRFHEmMUziOcxxHHM/NlsBpRSqFarL7l370t7g7MhVRUlkSQ5UWQ10RSNoatGosoaQ1lZSb1m1ZUe65oB1crBM+7tm1JBFBVwiU39wKWmr4Ew6cPIGsA52pTxdIAMYWQjlgBj+5zlXOlUMM8WeqDAt+aXIlc6OCwYlgNT16eG7dGRYYE20UGzJjAlHn46gUHfgP6pBrJswNgUQFD74OL1TAMCTkCoEwaLMJnDp6OjIlc9bBfCOUCUAHXJBVU1G/SJi/c4h+gCwJlGMJ1E4NkxODJuYnvgWHi3lo/3umTrkMUSAJo/fha58sdaYeIE4JGImnjCsaiCbthgOT4QzBRlLT09BHEChmnhZvg1DgEbdT+YQRAlFPMWCwrQPsaCn7/WC4pugu8TejUgHaldLpf/+Kv5Koagu1yk8U7nV5H7Xq8XAkLA9SOKvz8FrsPaZC22Bq6JWUHs1SJXq9X2CBYkxF9iH/6F7/t/WNfW8i7SnsTGfp4WfByGETbqnDXqHG2SJIx0Hs1idpI0fhNpXjrq9foLrlT+8Ojk9MyWJMmUJNGUZdlUVdXUNM3E52T2h+fmUBDMS/3/4Bodn6BfqVSecpnsnVv37+08yGYyu5lMJr+5uZnf2NhgbG1t5Xdyd/O57W2MX2o3kc1m87lc7vZvCwZtCjzzg/4AAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script3\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-16ce1.png 213w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-898e7.png 425w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-8d63b.png 850w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-c39de.png 1275w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-12da9.png 1700w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-894f8.png 2550w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>从这里我们可以看出，DOM即使构建完成，也需要等CSSOM构建完成，才能经过一个完整的CRP并呈现画面，因此为了画面尽快呈现，我们需要尽早构建出CSSOM，比如</p>\\n<ol>\\n<li>html文档中的<code class=\\\"language-text\\\">&lt;style&gt;</code>或者<code class=\\\"language-text\\\">&lt;link&gt;</code>标签应该放在<code class=\\\"language-text\\\">&lt;head&gt;</code>里并尽早发现被解析（第4部分我会分析将这两个标签放在html文档后面造成的影响）</li>\\n<li>减少第一次请求的CSS文件大小</li>\\n<li>甚至可以将最重要部分的CSS Rule以<code class=\\\"language-text\\\">&lt;style&gt;</code>标签发在<code class=\\\"language-text\\\">&lt;head&gt;</code>里，无需网络请求</li>\\n</ol>\\n<h4 id=\\\"页面首次出现图片\\\"><a href=\\\"#%E9%A1%B5%E9%9D%A2%E9%A6%96%E6%AC%A1%E5%87%BA%E7%8E%B0%E5%9B%BE%E7%89%87\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>页面首次出现图片</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACt0lEQVQ4y52Ty27TUBCGvUVi0zZRaAQIiXTLU7BKKyGxg7DghTALFjwCrKClJQlpoVBVFDUX5SI7t9qJnTgXO3YSO77Exz7DsUnKBlgw0ifPnPk9Gs8ZU8VceodhCi/ZRoNmWZZuNOo0U2/QpXKFLhaLdKFQoEulEl0ul2mGYUINz/O0KIq0IAhrXnQ7nVf5/OUD6jiXfaQbM7AsC/S5DpZpwtywQJsbYWySOMgF2LYd4jgOLJfLkMC3CRgAcicnz6mjbDrZbrewKAqusEboumJP/B0T+v2+2+ut6V3TlyS3z3POqMlCbv/dE+ro9DDZHDSAG7cwN27ijnoFfIDSAi5g0oL+VATkI3BcG1zkgut64Ngu6d4hLLG79DwwF5C/OE9Rnw6O9gYCB9K4hyVVwSzfBEFswXCqwFAdgzTqgzwZwlgZgOZYoPSrINQ/AtfIQKd+AHx9HyvSsSddncHBm7cp6vDDl11lqIGqmXhBRjGU5zAaqGC5ALJqkuIKKIoOkjQBwwGwphPgW9+hcPYaODYDzGUG18qnnjbkoXryOUVlvl4kNaLUTQdPdRPPSVXT8WBBKho2grmFSIzCMyP4zKkOi6kNrVoFpKsOSBfv8bh26SHVgOrZaYo6Pf+2O54o5LZs7HkIIzIjn4zE971fzxVeeOaDjxCBtE+uFQcajPBMkz2ka8AybIoiu7a7mC3ANuzg5gNCw3gNXrHyV6JrnxhCyAveYev1FPUj/yNZE8sgz0a+bui+NtVIc75PdCFEF7KO/wTJo7Agyz6lcufZPWZYBUnvhZ35Yf7/rFKpPKPS6ezDerOtkoWVyaLKkiTJg8EgpNvtym2uI3McH+b+wYj8fno2m31MRaKxG/fu3rkfiUR2CInNzc3ExsZGSCwWS9yO30rEt7cTW1sRwtZfiUajiXg8fvMnl1BqSDcXvsMAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script4\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-16ce1.png 213w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-898e7.png 425w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-8d63b.png 850w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-c39de.png 1275w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-12da9.png 1700w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-894f8.png 2550w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>上图说明，浏览器接收到部分图片字节后，便开始渲染了，而不是等整张图片接收完成才开始渲染，至于渲染次数，本例中的图片大小为90KB左右，传输了6次，渲染了2次。我觉得这应该和网络拥塞程度以及图片大小等因素有关</p>\\n<p>还有一点需要注意，两次渲染中，只有首次渲染引发了Layout和之后的Update Layer Tree，而第二次渲染只有Update Layer Tree，我猜想对于图片来说，浏览器第一次渲染便知道了其大小，所以重新进行Layout并留出足够空间，之后的渲染只需要在该空间上进行paint即可。整张图片加载完毕之后，触发Load事件</p>\\n<p><strong>上图包括之后图片中的Chrome扩展脚本可以忽视</strong>，虽然使用了隐私模式做测验（避免缓存和一些扩展脚本的影响），但我发现还是有一个脚本无法去除，虽然这不影响测验结果</p>\\n<p>接下来我们考虑JavaScript脚本对CRP的影响</p>\\n<h3 id=\\\"2-引入js\\\"><a href=\\\"#2-%E5%BC%95%E5%85%A5js\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>2. 引入JS</h3>\\n<h4 id=\\\"行内script-script位于html尾部\\\"><a href=\\\"#%E8%A1%8C%E5%86%85script-script%E4%BD%8D%E4%BA%8Ehtml%E5%B0%BE%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>行内Script (Script位于html尾部)</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACkUlEQVQ4y5WTSW/TQBSAfUXiUjWhNKoQEumVX8GpQULiBuHAH8Ic+B/tpZBGgQub2uyUNEtpNtuptzhOxh4viT2P50mDhFQOjPT5rfPsmfcs1EqF/Var8rbT64mddkfsdrviRacrNs9/irVaTaxWq2K9XhebzabYbrc5w+FQlCRJHI/HHNTfjEajd5VK5bFQKp48c1wCxHFgbttAqQtzh4K1ILBYzMFFm3oUPM8D3/c5QRBAGIZIwPXExxiDUqn0Wnh/8uFgMBgySVKWiiQvFWWyVGSFM0FdQp+MsYS1Lv/ROWM5yQ0wFwt+fCFUq+VcgG+w7AWTlAnTDBNs4nDmiONSIMiC2wTsxQ2oWzYB3VwwuvQjAAYXF+d54eiomJP6MhBVZaams6mqgaUbYJtTmM9s6F0N4Wqs4EYLTLR9xwUPi3NJPXDNKXOky0jSZnB4/CUvHB5/zkljDTTNYubMZdRnQGgEjrdG1my4tnBjwMC0PZjgRt0koKgWaNdTcMw58zQtsnUKX7818kLh0/ecMSMwnTvMJh4jNADXXyIroAlhDMRb64SGeGwPm+ZzVH0K3cs+s671CKIYGj9aeaFar+d0y8aOEmbPZszFbjMWQxRFECMbyYljHtvIpLPYZYbdxjsEaLWwID5yq9UKgjBkGt4hpRT+czGEF8QZzQvlcvkgmTEkxmLxRq7xuP2371ZWyUkajcZL4fT09KmLX5UMKB/YILwZ2pAPLPV8PtSb+G0keck6Ozt7JRQKJ086vUtLlmUjYTKZGKqqcsajkfGrPzT6g4Gxid+Goiga/n6kWCw+F1Lpe3cePth7lE6l9lOpVHZ7ezu7tbXF2dnZye5l7mczu7voX8f+RTqdzmYymbu/AbtmcG4XVYZ2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"inline script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-8d63b.png\\\"\\n        srcset=\\\"/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-16ce1.png 213w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-898e7.png 425w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-8d63b.png 850w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-c39de.png 1275w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-12da9.png 1700w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-894f8.png 2550w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>上图来看，Parse HTML这一过程被JavaScript执行打断，而且JavaScript会等待CSSOM构建完成之后再执行，执行完成之后，DOM继续构建</p>\\n<p>前面的例子中，我们看到DOM几乎都是在CSSOM构建完成前就构建完成了，而引入JS后，DOM构建被JS执行打断，而JS执行又必须等CSSOM构建完毕，这无疑延长了第一次CRP时间，让页面首次出现画面的时间更长</p>\\n<p>如果使用外部script脚本，这一时间会更长</p>\\n<h4 id=\\\"外部script-script位于html尾部\\\"><a href=\\\"#%E5%A4%96%E9%83%A8script-script%E4%BD%8D%E4%BA%8Ehtml%E5%B0%BE%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>外部Script (Script位于html尾部)</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACrklEQVQ4y3WTS2/TQBDHfUXiUjWhNKoQEumVT8GpQULiBuHAF8Ic+BYcobRJ0wMSB9o0aYJKkj7yauJHsn6vH2s79g5jR0KigKWfZnZeGmv/K7Qbh7s/e633/cuBeHFxIQ4GA7F/eSW2O12x1WqJ7VZbPD8/F7vdrtjv98VerycOh0NxNpuJt7e3Oei/m06nH7D+qXB8VH9BqQ1htIJVkgJjAZiOC7pNwbZt8DwPfN/PCYIghzEGYRgCC1nuB9jDOYdGo/FW+FI72BtPplzTaRwnPHYsO57P57GiKLEkybEsK3iWYkmW1xZj0lyOFVmNFUmNVXmREarKAur1+iuh0/1RUWUJRsNLrmkqd10LlkQGFnngMYq4ufUD9JEAsXwTJtpNzphcc7QJcRU4bTarwvHnWkWdyzAZTbgqSZyoC9AWSzCWBDSLAg0Y+NQD11gC1We5T3UNdIOAbRlg6ITbjpl4jglfa/tV4ejjp4rrp0AZcM1wuU0j8EIAx/TAdBMIVgCBtwLXZ2A5Rn72iYkbp0A0CurCynoSjvF2o1EV6vvHFX2pg62Z3DGsDPDwQlzE8XA4w2GmDYqkwGw6A9OwwTfMdR59Wzc5tZwkYRF0T/GXv31vV+QFAYc6PMWrStIE0K5JU7RIFEHs0ZzE94An6xoOkIEeJOhCr9+vCmdnzYrnupkseMgYz2TwFyiREIdmsDC6m8968oHdTqcqnJyc7Lk4EEkdx/kDSulv7ubu1K0yXaKwX2cDn/t+AFG2AQYzG8dxTnYOWJhvksX/R1aXfc1m841wcFh7Nri6NlDMZD6fEUmSCIqaqKpK8DmRm9GEjMZjss7/G+xZ4BOkKOyXQqH44N7jRztPioXCbqFQKG9ubpY3NjZytra2yjulh+XS9jbG17n/USwWy6VS6f4vT4puyFGkYREAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"separate script file1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-8d63b.png\\\"\\n        srcset=\\\"/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-16ce1.png 213w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-898e7.png 425w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-8d63b.png 850w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-c39de.png 1275w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-12da9.png 1700w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-894f8.png 2550w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>对于网络请求的资源，浏览器会为其分配优先级，优先级越高的资源响应速度更快，时间更短，在这个例子中，CSS的优先级最高，其次是JS，优先级最低的是图片</p>\\n<p>我们主要来看第一部分，后面部分和第1个研究类似</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACkklEQVQ4y5WTS2/TQBCAfUXiUjWhNKoQEumVX8GpQULiBuHAH8Ic+CNcSh2FUx+oTdIoFc2jtE0cv+PE9Wv9jL3DrEMrQPTASp9mxzM7npmd5U6be9vn/c7H4cWIHw4G/Gg04gfDC/602+M7nU5Bt9vle70eP0B7v9/nr66ueEmS+Ol0WoD7D6IofkLf51yzIbzyfRd8EoBtO+D7HtgeAcv1wHVdIIRAEAQQhoywII4jiJMY5YooioBSCs1m8z23K+ztTCYTKopqKit6qioaoqbSVE5FUUoV1BmSpBRSltViv0K+JcYzIAjCG67dOqklMf41iqksSXQ8vgTD0MA0dZAVEXRdhfncAMexQNPkAtMwUTcgiH0IE0KRLM0TOPp2WOc+C/u1iWaD64d0trCoNjNhbt2A47ngYalzm7WDQIil+ah72BqCZZMoxNbYMFVtOrO8LMlz2D84qnO7X09qzsKHwIspQUI/AXPhgWzcIA5IMw+DBqCjz8zCfpIUAvQJyRLcmQWGlVIvgiwFgE73rM4JzcOatbDBcQm1HZ+iZNmC7QZwg8wdgtkGd/gkwouKUMZA0C+IUkqiZbbMAXpn3+vcwVG7pmJP8EYpW1mWFTd2C/y2Z+RYWk7zX7LQKc3zDBOEfv+8zrXbrRrxfTYaFEeAshH4T/BMXATEWa1zx8fHOz4GRHLM8g88z7vjb9tffks2jzjYb1nAl0EQQpIkxZAymaZpAdPDaDW47Pt9MD+2Wq3WO+7LnvBiePHDkmXZlGXJVBTF1DTN1HXdxOdkXl5PzOvx2FzZ/w2eMfAJeo1G4zVXKj968PTJ1rNyqbRdKpWq6+vr1bW1tYKNjY3qVuVxtbK5id9Xtvsol8vVSqXy8CcW3W+pIzih7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"separate script file2\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-8d63b.png\\\"\\n        srcset=\\\"/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-16ce1.png 213w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-898e7.png 425w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-8d63b.png 850w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-c39de.png 1275w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-12da9.png 1700w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-894f8.png 2550w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>可以看到，增加了对JS文件的网络请求时间，一轮CRP时间更长了，对比上面的行内Script可能时间差异没有那么明显，是因为这个例子中的JS文件体积小，传输时间只比CSS多一点，主要决定JS何时执行的还是CSS，如果JS稍大，由于请求优先级低于CSS，则差异会明显变大</p>\\n<h3 id=\\\"3-async-script\\\"><a href=\\\"#3-async-script\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>3. Async Script</h3>\\n<p>如果Script会对页面首次渲染造成这么大的影响，有没有什么好的办法解决它呢？</p>\\n<p>答案是肯定的，就是使用异步脚本<code class=\\\"language-text\\\">&lt;script src=&quot;&quot; async /&gt;</code></p>\\n<p>使用异步脚本，其实就是告诉浏览器几件事</p>\\n<ol>\\n<li>无需阻塞DOM，在对Script执行网络请求期间可以继续构建DOM，直到拿到Script之后再去执行</li>\\n<li>将该Script的网络请求优先级降低，延长响应时间</li>\\n</ol>\\n<p>需要注意如下几点</p>\\n<ol>\\n<li>异步脚本是网络请求期间不阻塞DOM，拿到脚本之后马上执行，执行时还是会阻塞DOM，但是由于响应时间被延长，此时往往DOM已经构建完毕（下面的测验图片将会看到，CSSOM也已经构建完毕而且页面很快就发生第一次渲染），异步脚本的执行发生在第一次渲染之后</li>\\n<li>只有外部脚本可以使用<code class=\\\"language-text\\\">async</code>关键字变成异步，而且注意其与延迟脚本 (<code class=\\\"language-text\\\">&lt;script defer&gt;</code>)的区别，后者是在Document被解析完毕而DOMContentLoaded事件触发之前执行，前者则是在下载完毕后执行</li>\\n<li>对于使用<code class=\\\"language-text\\\">document.createElement</code>创建的<code class=\\\"language-text\\\">&lt;script&gt;</code>，默认就是异步脚本</li>\\n</ol>\\n<p>直接看图</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACrElEQVQ4y5WTSW/TQBTHfUXiQNW0JRVISKRXPgWnBgmJG4QDXwhz4HPQA2pLm96AUqI0hRRna5Y63u3ENt4Sx3Hmz3NYhQSIZ/301nkezbzhauX9rUbj9Fmz3ebbrRbf6XT4RrPNnwsNXhAE/qx2tuTjhw98s9nkB4MBL0kSPxwOf+WpKIrPq9XqHa5cPrjv+S6iKEIYBphOJ/CCCI4XIPB9ioWUC5f5yWSCaTxFHMc/yPxsDaOvfHT0hNs9KG/3eiJTFC1RVD2RSUuSQqiJJGuJphmJrlmJrpqJqY9IG0tbI60pX20i1lQN+3t7D7lK9bRouhHafYmdnjfZebuH9uUQkmlDNsdQRxcQxHP0TAHC8BRd0v1RA12DYsSFXmd981M6xwzvq7USt/PioKgNFBiqwi76AyZKMszRGCPbhmuaUC97MMQO5LGMS62HXrcORe9CczUYvgHV1Zjuqmmgd/B6d6fEvdx7WzSUERw7YG6YMtuLYdoRZN2BqliwDAe26cL1EoQTBrEjwnPoLBPAdmM4/pw59iQNFA2V129K3O7Ru6Ksj6EbFjNHDtPNEWzHg/05IOgyZinCmKAOwWSGIJ6TP4cfxfSTkC4vZK4fpdMUqNU/lbjj4wo1tGHZIfPCOZFQ8RzzdAHGFkjpdNI0XbL4xg97schgJNQOEARqeHZWK47HNjw/ZAxgVIOM/xBahmXDVqtV4iqVyvZn181mbjGL40X8nen0p/1v5rRL1Ov1R9zJycm9aDLFbDajAf06tJn93Y9omLOB/nWYfyery4Q295jbf3Vwt9W5sCVZtmRCVVVL1/UlQ1G0uv1Lqz8YLHN/QlEUg56ff3h4+IDL5dav3Lp543Yul9siCqurq4WVlRXiWmF9Y6NwY/N6YTOfX8b/xtraWiGfz1/9AgBebBrIQTHSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"async script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-8d63b.png\\\"\\n        srcset=\\\"/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-16ce1.png 213w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-898e7.png 425w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-8d63b.png 850w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-c39de.png 1275w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-12da9.png 1700w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-894f8.png 2550w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACx0lEQVQ4y32STW8SURSGZ2vipilYJcaYiFt/hSsxMXGndeEfcly4cmP8BWo0toLWalMt1BakAgOY4jAfgMDwMd9zmbmvZ6a1RqPe5MnJec/NmXPmvkL59frlemP/vtRqic1mU2xRrEtN8aBWF+v1ulgulxM+Vz6LjUZD7HQ6oqIoYrfbPYHye7IsP9jb27si5PPrN6YzA47jwLZteJ6LmeVgMrdgmmaiO64Ll/A8D77vIwiC34g1gKNQKNwVnrx4ca3dbHJd1ZiaoBIK0yhq2lGuaeqxrjKa5iQqdI8mZF256+u9ftzwllAs7uRc+jILGfeZx9ligUUIyjkYC4kIQUwQ/iLJIywWHHPL5fZ0FCIK8KVeWxXyhc2cLksYjHTeM8Zcae/gsPoMqrSG7/ImvnffYKy9xVh/R2xhpG6QnofRi7UNTLQ3XGtLoTHSsf1ha1V4vbmb05Qe5mbAHR98OlAw0GuYDCSMJgqk5jYOio9R332E1qeHaFef4ltrAwell6h9WoNUfc9n/VEYehzlajzhZjHXH1uY0ujzucXNyRweAxy6YDshLDOEqoyxt/MRxa0C5I4Oc+JDq9D05ecYtSXuTs0wol9UOaCG2x9KOaU3ppVNPrMCPjHmmBkzMNtC5NqIPBsIXCzolZnrgQceQtdCYM8ROCYC0+DBhP4hnVqNGlYq+7mxYdDKNuf09hEVYv53wiiCaVmwyGamaXHHspKG5ONVoVTavTabTmk1MwoCP/J97wgvjv4vvCPNO9YZPT+jp04iY4u4YbVavU22KV53aJXYoH8aN85/mjrW/0Z8J67Hp1Qq3RHW1l9dbbTahqKqQzLsUNf1Yb/fT+jK8vDr4bfhYaeT1MjoJ/Enx/mAjG7m8/mbQip95tTFC+cvpVOpy6lUKru8vJxdWlpKWFlZyZ7PnM1mzp0j/aj2L9LpdDaTyZz+ARbmZ7KZk4J/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"async script2\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-8d63b.png\\\"\\n        srcset=\\\"/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-16ce1.png 213w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-898e7.png 425w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-8d63b.png 850w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-c39de.png 1275w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-12da9.png 1700w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-894f8.png 2550w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>由于Script执行修改了DOM和CSSOM，因此重新经过Recalculate Style生成Render Tree，重新计算Layout，重新Paint，最终呈现页面。由于这一过程仍然很快（只用了140ms左右），因此我们还是察觉不到这个变化</p>\\n<h3 id=\\\"4-css在html中不同位置的影响\\\"><a href=\\\"#4-css%E5%9C%A8html%E4%B8%AD%E4%B8%8D%E5%90%8C%E4%BD%8D%E7%BD%AE%E7%9A%84%E5%BD%B1%E5%93%8D\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>4. CSS在HTML中不同位置的影响</h3>\\n<p>前面留下了一个问题，CSSOM没有构建完成，为什么刚开始的Parse HTML同时就有Recalculate Style这部分？或许这部分会给你一个答案</p>\\n<p>这里为了避免JS带来的影响，使对比更有针对性，删除了JavaScript</p>\\n<h4 id=\\\"设置style在html文件头部\\\"><a href=\\\"#%E8%AE%BE%E7%BD%AEstyle%E5%9C%A8html%E6%96%87%E4%BB%B6%E5%A4%B4%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>设置style在html文件头部</h4>\\n<p>先来回顾一下在头部设置<code class=\\\"language-text\\\">&lt;link&gt;</code></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACmElEQVQ4y5WTyW7TUBSGvUViUzWhNKoQEumWp2DVICGxg7DghTALHgVBM0ggKjopdkho7STN5NmJE89jbpJ7uHYqRAtdcKRPZ7o6Prb/SzXrn/c5jnnf6XVpnufpbrdDc50u3Wy1aZZlaZZh6GazSbdaLZrjOJrneHo0GtGSJNGiKGaQ+J0gCB8YhnlK1WrVF57vQhhF4HsehGEIjh+B7Xrguk6WZ5B+slhAFMcQE5IkIWziOI4AMIZ6vf6W+lStHYzHElaGfTRs/0DiVQ8poojGlxdIHfSRLClIUXVSk5HQ6SJVkJE+mSFVnSJN+02iaROoVCqvqAbTKCVhAEvTwEiXMRIHMP3ZBPn0CGbEe/0eWEMOxKtTaB9/hD53BKLQBGHMbrzAYnHErNaJD1y3W6ZqX09Kpu2B7QV4YnpY002YGTOYzy1wbJd8Bh9sy4UJqVm+DZqlgU4YKAOQDQnUuYK1ubJyIw++HX8vU5WjVilYAPgJYHHqYVGzQJt5aQ52sMxiw45hRpiaAVgugngJMLUimDsJGGaE3RCvMAAwbLtMHX45Kc2d9GCILS/Grh+DHy4giNBfpHU/2pDlmxiT+iqd2GpflKkGy5YM0wbP87Bt2zgIAvLDMKxWK1jfZn3NnzkZtU4DYpeXl2WK57gSQgiiKMKKqmIyGP7T0rfNBvJ8h2zYaBykWiJaWzuOsyaDbxDfyu9gSbYEIv7X1NnZ2fOACDdJFrBY3CR7UBSn218L+d+k51I7Pz9/Qx0eVp51elemLMuGLEmGqqqGrusZoiAY/eHYGI5GRtZXlI2/haIoE3L9vGq1+pLK5R/ce/xo70k+l9vP5XLF7e3t4tbWVsbOzk5xr/CwWNjdJfVN7y7y+XyxUCjc/wWNdm5DH/XtDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-16ce1.png 213w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-898e7.png 425w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png 850w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-c39de.png 1275w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-12da9.png 1700w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-894f8.png 2550w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<span>link tag on top of html file</span></p>\\n<p>前面的DOM构建部分出现了Recalculate Style，之后获得CSS并解析后还有一次，一共出现了<strong>2次</strong></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACU0lEQVQ4y5XSW28SQRQA4H01MaHUn2D76q/wqZiY+Kb44B9yffCXmJgWrSa2SrfIRaAFSrehLGyhsOWy991Z5hzPjIW0jZc4yZczl7Mzk9mjVD7tbDYapTetdls9OTlR2xSbrbb6o1pTy+WyVKlU1Gq1qjabTanT6ai9Xk81DEOi/utut/u2VCo9UnI720/n9hw930PXdTAMApy7AU7mDtq2jb7vo09zAQnDUIqiCOM4lkRfAETc3d19pbx7v72ln3Whb5rMMHrM6PUYncj6/T4xr8f9W9Gg2DWMVT6JTPMCc7ncc+VQ0zIsjmh/cQgH5AkugbBgyK/BnYhciIHGC7FBvV7PKvvfCpnzwRRr+gjq+iUcda7w+HwqtU0X9WGApwNf0knrwsf2IMCzoYdHpxbWW2PQB8HCDREPtYOs8vFrNTPzOVp2AmObgeUkuHTlcpx4fBWFoU25LuDMY9jpTFA/ncLUh0VId8xrhazyYa+U8WPAgG7uhQvwIi766C/ReCkg84CjyBFrIQOMGAc/ggU9ElbrDbrhZy1jDsc4nc3B8wPwvID+Gvu9mGEY/RJFqz7QvHzDWo3e8HuxnJlNZxhNLKC/AAAcOf8vQOSGjcZxVikUClsO1ZsznXCqu1scx+EucW6w745tGRNRi8Vi8YWSzx88mTkuxiyRhZokiTyZriqL2KEn8Ki4GWN/JL4TTdO0l8qXvf3Hw+HlZHyjWZYljUaj8SUR8R+N0kZOPp9/pqTTqXsP1tcfrq2tbZKNVCq1kk6nN2htY52Itb8RuRTv/wSx5HL5YrXK7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script5\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-16ce1.png 213w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-898e7.png 425w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-8d63b.png 850w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-c39de.png 1275w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-12da9.png 1700w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-894f8.png 2550w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>再来看看改成<code class=\\\"language-text\\\">&lt;style&gt;</code>，Recalculate Style一共出现1次</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACe0lEQVQ4y5WSzW7TQBDHfUVCSlMegfbKU3BqkJC4QTjwQpgDrwJKhAiipWkoidMk4MSVSvBH0iZ2E3fXXn+s7R1mHQoCiSJW+mlmPB/r3f0r/beN3fG492JyeqpOxhPVMAxVnxjqyXCkapqm9no9td/vq4PBQB2Px6qu6+p0OlVt21YtyypB/7lpmi+73e49pdl4/dC/8iFkDK58HxgL4SpgsCIUCCEYM4iiqCSO45IkSSBNU0iTtPQlcrVarWfKq0Zz7+yrJRzH4TNnxi3b4Q5a3JXP53NuWTaXOdOyNta0uP0jvraWbSfObAbNZvOxomm9WpFznC/Ehlz6IIociqIAGhKgbA0+XUHEQ4izENIshjAOgCUYp5HgWSqbYDA8qSuNVrumT10YnS2F5NPEgw+fXRh+9XAYNjIO5hkFz03AXTL0CZgLByheQZIW4HhzYZwb+UWwgMN2p640909ql0EOHsnEZcCF8S0E7ZSA7RJYExyI1+NT/FMmgCBrksM6TCFIBLAUcywVqzDKWS7g8Oi4rrw50GoRnjhKhQjjQiQZFmIsBzFsCuICGwXGBSJKX37H2k0uEQIH54U88kjHge86NefchdXaFyGLRBDiq8YpxOULcjwW/2X/9DexQFve4XA4qivdbq+2RrlEEZ4HX0M+xH8ie8qBuv6lrhwff9yjlEIQBAXq7jfwexEg9AYIKW0mtYjCfqK0j44e+DRAofJSrFmWlTsLVJAUMQ2jUvSc878i++TqdDpPlff7B/cvLhYr1/Pc6+WhL1kul+4CkfYfC8uWtN1uP1Kq1cqtO9vbd7e2tnaRnUql8pNqtbqDuZ1tROZuQtaivf0dwKdy05kDYgoAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"style tag top\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-8d63b.png\\\"\\n        srcset=\\\"/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-16ce1.png 213w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-898e7.png 425w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-8d63b.png 850w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-c39de.png 1275w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-12da9.png 1700w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-894f8.png 2550w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<span><code class=\\\"language-text\\\">&lt;style&gt;</code>在头部，一开始就直接解析完成，没有网络请求</span></p>\\n<h4 id=\\\"设置style或者link在尾部\\\"><a href=\\\"#%E8%AE%BE%E7%BD%AEstyle%E6%88%96%E8%80%85link%E5%9C%A8%E5%B0%BE%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>设置style或者link在尾部</h4>\\n<p>先来看看设置<code class=\\\"language-text\\\">&lt;style&gt;</code>在尾部，Recalculate Style出现了1次</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACT0lEQVQ4y5WS227TQBCGfYuElCZ9BNJbnoKrBgmJOwgXvBDmgjdBqI0oSLSQNDROcBslblBTJXZC4xwcn4+7M8y6NEKACoz06Z/dndn1en+p825/p99XXmqDgaz1+/L5+bnc1wZy+4sqt9ttWVEUudPpyKqqyn1a7/V68nA4lHVdl8fjcQ7lL0aj0atWq3Vfqu3vPVrbNvq+jzZpINQLcWW76DgOzQcYhmFOFEUYEnEcY5IkOSIXAAAeHBw8l16/2dsdfL2EyWSS6rqR6oZQPZ3S2KDcEPOGkedi3aBc6His5+Q9uh5Pp1Os1WpPpNbJSSVJIqQABAYiYSwjGKZpilmWkSY/NN0ogKhJkXMGLMuY6Ot2u1Xp8NPnij5b4+mFCd2LGbRUAwejNdpugF4QYZQwDOPsJ67H3yYBzs0YzYULlu+wpW9h87hVld5+VCvrgOPSY6DPbFCaF6gN52j5KfoxoJ8gKf6mtsfR8QGdgIEbcxbSNzbyDY/alYAaI7qFG2QgTl96GTohp0aOXnSN/4sGCeTrdCgQjNOV1bMebfj+uDK5muPKWoMfhOD59KJxilGc/CtA5P/w9PSsKilKu7JcWcIWkD/M/4foyTfUNK1Kr9zctSzhw4CTzzhtvEGMYyK6hTDMNeOcI5n/qVSvNx7arrcxqbCEsIwoEGZ2PHptMvuNkf+E6BPRaDSeSR8Ojx5cXc1Wi8VifhMivx6b85lpzk3iL0Flpluv1x9LxWLhznapeG9ra2uHKBcKhQ3FYrG8XSqVS4RYuw1RS3r3O/tudhAlEVmOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"style tag bottom\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-8d63b.png\\\"\\n        srcset=\\\"/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-16ce1.png 213w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-898e7.png 425w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-8d63b.png 850w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-c39de.png 1275w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-12da9.png 1700w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-894f8.png 2550w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>再看设置<code class=\\\"language-text\\\">&lt;link&gt;</code>在尾部，Recalculate Style一共出现<strong>3次</strong></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACgUlEQVQ4y3WS2W7TQBSGfYuE1Cy8AektT8FVg4TEHQ0XvBDmggepkCpKEqktJdCG1GlSKUuJCl5bO4m3sT1eYs9hZrooEu2RPv3nnzNzPOMZQWrvbY5GvY+TiwtxPB6L0+lUHE8uxP7ZUJQkSTw9PRX7/b44GAx4fTQaiZeXl6KqqqKiKDeoygdZlj/1er0XQqv59bUfIAjDEDzPhyiiGmCwPQS+z3wEGGNOHMecJEkgTdN7mGfRbrffC7t7ra3ZH5UYupYZhpFpmkZRM516XdczleZsjClHVbjSXWWyImd/ZZlpomoaNJvNt8LwTKojukP9+orImkrm9hKWnktxwPE8cOmu73Bcj47deQTqQoaZNSEzc5JfhRoc939uCzuto/poqICmmcSwLWIsLGBoFNNFECc5hDjj+EHCNcIriOIc/AjDMvTIMvLzMHRh//NOQ9g9kOq2tgBXt8jcicjSxRDSX4IwATssgK6HMAWIbgnX1PYTcFFGAkzyxMPwvb3fEJpHUp0VURAT28fEQTFtWICPC9ow53kQP0QOlo1g7gRk4YS5H2Xwqz9oCIedH3Vz6YG5DAgKIoLjhB4z5eA4vc8fIkkzBkmzVc5ueXh+3hBOjnv137IDlpcQ17EJQghugnAIoUrIvV+H1cjNBN6QvtOG8OVA2moNHZgaURH4XhEEYUHnFCyY3kHdI/B5K9aQPvptods9eXVtB5BmOf1aAeuRZSm91YQePYYiz4Gu/Y+cjq9WvB90u913wsHht5eWadqLxXxuWdZ8PZg3TZPD8segYVJFnU7njVApl56Uy5XnpVJps1wu16jWNjY2OJVKpfasWqlVq9Uaqz0GW3ObP/0HnzVyjhMdLsEAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"link tag bottom\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-8d63b.png\\\"\\n        srcset=\\\"/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-16ce1.png 213w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-898e7.png 425w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-8d63b.png 850w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-c39de.png 1275w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-12da9.png 1700w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-894f8.png 2550w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p><strong>先总结实验结果</strong></p>\\n<p>实验中将<code class=\\\"language-text\\\">&lt;link&gt;</code>放在头部，<code class=\\\"language-text\\\">&lt;style&gt;</code>放在头部，<code class=\\\"language-text\\\">&lt;link&gt;</code>放在尾部，<code class=\\\"language-text\\\">&lt;style&gt;</code>放在尾部，<em>Recalculate Style</em>的次数分别是2，1，3，1</p>\\n<p><strong>然后我们需要了解Chrome Dev Tools Performance Tab的几个关键过程</strong></p>\\n<ol>\\n<li>Performance Tab里的<em>Recalculate Style</em>，官方是这样解释的</li>\\n</ol>\\n<blockquote>\\n<p>To find out how long the CSS processing takes you can record a timeline in DevTools and look for \\\"Recalculate Style\\\" event: unlike DOM parsing, the timeline doesn’t show a separate \\\"Parse CSS\\\" entry, and instead captures parsing and CSSOM tree construction, plus the recursive calculation of computed styles under this one event.</p>\\n</blockquote>\\n<p>在Performance Tab里面，没有看到<em>Render Tree</em>构建这一过程，这一过程也被浏览器隐藏在<em>Recalculate Style</em>里面，所以<em>Recalculate Style</em>既可能包括CSSOM的构建，也可能包括<em>Render Tree</em>的构建</p>\\n<ol start=\\\"2\\\">\\n<li>\\n<p>对于<code class=\\\"language-text\\\">&lt;style&gt;</code>里的CSS，解析过程发生在<em>Recalculate Style</em>中，而<code class=\\\"language-text\\\">&lt;link&gt;</code>获得的CSS，解析过程是单独的，叫做<em>Parse CSS</em> (和<em>Parse HTML</em>类似)</p>\\n</li>\\n<li>\\n<p>同时，要明确浏览器还有一个默认的<em>User Agent Style</em>，我们的Style只是对其进行一个覆盖</p>\\n</li>\\n</ol>\\n<p><strong>最后猜想这4个结果的原因如下</strong></p>\\n<ol>\\n<li>浏览器如果发现<code class=\\\"language-text\\\">&lt;head&gt;</code>里存在<code class=\\\"language-text\\\">&lt;link&gt;</code>，则会等待CSS网络请求完成并解析好之后才开始Render Tree，至于第一次的<em>Recalculate Style</em>，我猜想是默认的<em>User Agent Style</em>，此时CSSOM已经开始构建了，而接收到CSS文件，我们设置的Style会对默认的Style进行覆盖。这里第一次<em>Recalculate Style</em>只包含CSSOM构建，第二次则包含了CSSOM更新以及<em>Render Tree</em>构建</li>\\n<li><code class=\\\"language-text\\\">&lt;style&gt;</code>放在头部，浏览器因为可以马上拿到CSS，就可以马上进行解析，此时<em>User Agent Style</em>的解析和我们自定义的<em>Style</em>解析合并，<em>Recalculate Style</em>包含了CSSOM构建和<em>Render Tree</em>构建</li>\\n<li><code class=\\\"language-text\\\">&lt;style&gt;</code>放在尾部，和放在头部类似。只不过晚点发现CSS，但是由于是行内<code class=\\\"language-text\\\">&lt;style&gt;</code>，还是可以马上解析</li>\\n<li><code class=\\\"language-text\\\">&lt;link&gt;</code>放在尾部，浏览器一开始没发现<code class=\\\"language-text\\\">&lt;link&gt;</code>，会使用<em>User Agent Style</em>（2次 <em>Recalculate Style</em>），后面才发CSS网络请求，最后再触发CSSOM的更新（1次 <em>Recalculate Style</em>），这是最糟糕的情况。这里的3次<em>Recalculate Style</em>分别指CSSOM构建，<em>Render Tree</em>构建，CSSOM更新和<em>Render Tree</em>构建。<em>Render Tree</em>构建两次，页面发生两次渲染，为最糟糕的情况</li>\\n</ol>\\n<p>所以，我们需要将<code class=\\\"language-text\\\">&lt;style&gt;</code>和<code class=\\\"language-text\\\">&lt;link&gt;</code>放在头部，对于<code class=\\\"language-text\\\">&lt;style&gt;</code>在尾部，这个例子省略了JS的影响，如果加入JS，则结果又会不一样</p>\\n<p>本来想再测试一下JS在HTML中不同位置的影响，但是就CRP这一过程来讲，这部分比较容易叙述清楚</p>\\n<p>因为JS不管在哪个位置都会默认阻塞DOM。如果DOM尚未构建完成，JS中对不在DOM的元素进行操作，会抛出错误，脚本直接结束。如果将脚本设置为<code class=\\\"language-text\\\">async</code>，则放在前面也是OK的，例如使用<code class=\\\"language-text\\\">document.createElement</code>创建的<code class=\\\"language-text\\\">&lt;script&gt;</code>，其默认使用的就是异步</p>\\n<h2 id=\\\"总结\\\"><a href=\\\"#%E6%80%BB%E7%BB%93\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>总结</h2>\\n<p>这篇文章是我阅读了Google Developer的<a href=\\\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/\\\">Web Performance Fundamentals</a>后，自己做实践得到的总结。非常建议每位FEDers阅读这一系列文章。文章作者<a href=\\\"https://developers.google.com/web/resources/contributors/ilyagrigorik\\\">Ilya Grigorik</a>还和Udacity开设了联合课程<a href=\\\"https://classroom.udacity.com/courses/ud884\\\">Website Performance Optimization</a>以及他关于<a href=\\\"https://www.youtube.com/watch?v=PkOBnYxqj3k\\\">Web Performance的一次演讲</a>，都值得一看</p>\\n<p>由于水平有限，我只看了前半部分（关于CRP），后半部分则关于在Web Performance Optimization的实践</p>\\n<p>疏漏之处，欢迎指正</p>\\n<h2 id=\\\"参考\\\"><a href=\\\"#%E5%8F%82%E8%80%83\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>参考</h2>\\n<ol>\\n<li><a href=\\\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/\\\">https://developers.google.com/web/fundamentals/performance/critical-rendering-path/</a> (Recommended)</li>\\n<li><a href=\\\"https://classroom.udacity.com/courses/ud884\\\">Website Performance Optimization - Udacity</a></li>\\n<li><a href=\\\"https://stackoverflow.com/questions/5797014/why-do-browsers-match-css-selectors-from-right-to-left/\\\">https://stackoverflow.com/questions/5797014/why-do-browsers-match-css-selectors-from-right-to-left/</a></li>\\n<li><a href=\\\"https://www.youtube.com/watch?v=PkOBnYxqj3k\\\">https://www.youtube.com/watch?v=PkOBnYxqj3k</a></li>\\n</ol>\",\"frontmatter\":{\"title\":\"深入理解浏览器解析渲染HTML\",\"date\":\"September 20, 2018\",\"excerpt\":\"除了知道如何用代码实现一个页面之外，最重要的是明白这个页面是如何被浏览器解析和渲染，并最终呈现在我们面前的\",\"contents\":[{\"text\":\"前言\",\"subContents\":null},{\"text\":\"critical-rendering-path\",\"subContents\":null},{\"text\":\"构建dom\",\"subContents\":null},{\"text\":\"构建cssom\",\"subContents\":null},{\"text\":\"构建render-tree\",\"subContents\":[{\"text\":\"扩展：css匹配规则为何从右向左\"}]},{\"text\":\"layout\",\"subContents\":null},{\"text\":\"paint\",\"subContents\":null},{\"text\":\"引入javascript\",\"subContents\":null},{\"text\":\"使用chrome-dev-tools检测crp\",\"subContents\":[{\"text\":\"0-代码部分\"},{\"text\":\"1-不加载js情况\"},{\"text\":\"2-引入js\"},{\"text\":\"3-async-script\"},{\"text\":\"4-css在html中不同位置的影响\"}]},{\"text\":\"总结\",\"subContents\":null},{\"text\":\"参考\",\"subContents\":null}]}}},\"pathContext\":{\"slug\":\"/learning/2018/09/20/How-a-Webpage-is-Displayed/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---learning-2018-09-20-how-a-webpage-is-displayed-0cbdfea97b526d18735d.js","module.exports = {\"data\":{\"markdownRemark\":{\"html\":\"<h2 id=\\\"前言\\\"><a href=\\\"#%E5%89%8D%E8%A8%80\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>前言</h2>\\n<p>回顾自己的前端学习历程，现在都还不能深入理解浏览器对HTML文档的解析和渲染过程。最近被问到HTML的重绘(Repaint)和重排(Reflow)，才想起自己根本没仔细研究过它。</p>\\n<p>作为前端工程师，我们每天写HTML，CSS和JavaScript，但是浏览器是如何解析这些文件，最终将它们以像素显示在屏幕上的呢？</p>\\n<p>这一过程叫做<em>Critical Rendering Path</em></p>\\n<h2 id=\\\"critical-rendering-path\\\"><a href=\\\"#critical-rendering-path\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Critical Rendering Path</h2>\\n<p><em>Critical Rendering Path</em>，中文翻译过来，叫做<strong>关键渲染路径</strong>。指的是浏览器从请求HTML，CSS，JavaScript文件开始，到将它们最终以像素输出到屏幕上这一过程。包括以下几个部分</p>\\n<ol>\\n<li>\\n<p>构建DOM</p>\\n<ul>\\n<li>将HTML解析成许多Tokens</li>\\n<li>将Tokens解析成object</li>\\n<li>将object组合成为一个DOM树</li>\\n</ul>\\n</li>\\n<li>\\n<p>构建CSSOM</p>\\n<ul>\\n<li>解析CSS文件，并构建出一个CSSOM树（过程类似于DOM构建）</li>\\n</ul>\\n</li>\\n<li>\\n<p>构建Render Tree</p>\\n<ul>\\n<li>结合DOM和CSSOM构建出一颗Render树</li>\\n</ul>\\n</li>\\n<li>\\n<p>Layout</p>\\n<ul>\\n<li>计算出元素相对于viewport的相对位置</li>\\n</ul>\\n</li>\\n<li>\\n<p>Paint</p>\\n<ul>\\n<li>将render tree转换成像素，显示在屏幕上</li>\\n</ul>\\n</li>\\n</ol>\\n<p>值得注意的是，上面的过程并不是依次进行的，而是存在一定交叉，后面会详细解释</p>\\n<p>想要提高网页加载速度，提升用户体验，就需要在第一次加载时让重要的元素尽快显示在屏幕上。而不是等所有元素全部准备就绪再显示，下面一幅图说明了这两种方式的差异</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-a5e4a.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 611px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 49.09983633387889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACo0lEQVQoz1WSXUhTYRjHJyIr2xBhyMCbMCfUSitF14V4oWBeSAwsgvBidzovLLrprsvQqwnRB3URoc2EGqarNe3s0OY8uraxue+PZM61763tzJ325el5RgY+8HJ+73ve83//z/89nAaotra2Bg6UQqFoHhoaunxzdLTj3YqK23XleufF7l7x3MKLMyLx1fOdl3p6Ju7JeGPSu63Iw2O3Wu8/eszr7rshHhgcbp+4faeu8798Pt/LUqnE5vP50DeC0FAmC/19i2LW1Z+R9427lupH1apux2QObZusVY12cxtebZMGqmKkTJHJycleDhjsEAqFF0CPm0ql3rBQtVot5/V6DcgFmmZdLpehWq1mcW6320yl0p/fyAehkMNqsTgy6TRL0/mj2dnZfjQmaWlpkcCzPRqNLuJG+Djvdru32H+FnMlk6iJ7e3s/YrFYDjkYDDoDgYATDLDpdLo4NTXVX3coEAhEIHgWNi4cHx9XoG2fw+FYLZfLSRhZZIZhPGgY3H61Wq1ej8dTgIN0ZrNZBxM6Fo0GZ2Zmrp3KkCTJB/ABabPZlGtra0/sdvs6jC/IsLYEIptqtXrOaDQuudzuDYNB/+ztovKpal2j/aTWrIyPj4s4jY2N50ZGRngoGA6Hl7EVcMg4nc6dk5aRYe0IGUSpbDZbQE7E4wc6HRn4uR9i/YFgZXp6egB1Bvl8/iBmGI/HX+PGSqUSh3YIyKYKEWCGBKxF8R38CUQul/tVF0wknB6P21oo0CzDFNPQch+nqamJK5VKm1E5mUwqcSOIlOCWTScOkUGcQYZL2KVpuogMf0UYIgpCzizkX5PL5ZJTGUJOD8Gl4fDwcEWv189HIhENjA1kWHsPB5KQ37zf718GJiCKV1qt9jlFUQQc+kEmk3X9BYHqF7qoGS41AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"progressive rendering\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-a5e4a.png\\\"\\n        srcset=\\\"/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-b200a.png 213w,\\n/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-d4624.png 425w,\\n/blog/static/progressive-rendering-e58351df6b94ecd408d64131f9282fe2-a5e4a.png 611w\\\"\\n        sizes=\\\"(max-width: 611px) 100vw, 611px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"构建dom\\\"><a href=\\\"#%E6%9E%84%E5%BB%BAdom\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>构建DOM</h2>\\n<p><em>DOM (Document Object Model)</em>，文档对象模型，构建DOM是必不可少的一环，浏览器从发出请求开始到得到HTML文件后，第一件事就是解析HTML成许多Tokens，再将Tokens转换成object，最后将object组合成一颗DOM树</p>\\n<p>这个过程是一个循序渐进的过程，我们假设HTML文件很大，一个<em>RTT (Round-Trip Time)</em>只能得到一部分，浏览器得到这部分之后就会开始构建DOM，并不会等到整个文档就位才开始渲染。这样做可以加快构建过程，而且由于自顶向下构建，因此后面构建的不会对前面的造成影响</p>\\n<p>后面我们将会提到，CSSOM则必须等到所有字节收到才开始构建</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-f06f1.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 55.38735529830811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADTUlEQVQoz2NgmhPcyDDdbwXDZJ/FDAuC5/Fl2+uJMbBJiMhIyggKCSmIiYlLqalr8IOwhqYWn5KyioCWtg4viK2qps6vqaXNp6ikLGhqZsH9//9/Rob+Q7squvdunde+bf3cicf2TamYM1WFgYGBy9HBWsDCRI/PSFeD38PFjtvZ3pLHzcGS28vFhtvV3pIbxPZwtuEO8nbmPLtnOcvW5VNZVi+dycxw8cbLkiOnb8/cvu/MzKt33vUtWL5FNyQiVCUqIU05IS1LMSYxUTMwLFY5MiZGPSIuUd0/NFo9PDpKKzA8Ti08OkYjKT1TZcexS4L7jx0SPXHmPDfDrsufKrdfeDd//bHH8/de/967dN+DhDm7npevOPo2e+Geh+Vz97zOP3ztc/6KY99TFu6+V7vmxPviGdue5q099qxm3r4PmXN3PipZBRRbceJ33slbf9wYXp0vL390vHDu9X05c95fKuu/cLDd6uqB8t5zh3ocz+xrCbi4t6xl34lTElcOVNaf3tMQfPzADKPL+8u79u6er3HnRF3pzWMNqRePTXK4fqhi7q2T3VYMb04lVz4/Gj//zp7YeR/PJk25uidf887x2oALh3plrh9tVbt7vDJg3dZ9bHeOV/vcO15pf+tIpcmto1Wxh/bMErx7ss7p7slG88tHOpRuHKkJPbW/R4Lh4/n0mnenkxc9OZww79ul9Nl39qfJAyOF4c6+DO4ru3P4Qexpyw+wgeiz+5vybxwuX8WAD6gaRTIe2TmL8f//24yWLkmM/0/qMO49uIzzyqHqwhuHy+Yt3bBUjcHkIFP3ikPcFw825t88UtYu3PCflYHhP+ODU9W8b87nsYPMeXY6nfHxuRiEwXlhQCX/IexbR8qqQQbeOtHgdu9E9ZJdR05r3D3ZMPHm8dqmhPn/eRZsOCc9f88z0ZtHq1Y8OFWZDdLz/VIy44kD0xgYnhxJY3h1MpXh5cl0hlfHY8EGXjtQxProbC/Y5ou3nkefvPp6/plTm4qv7CtccebCuZpDZx8vOXfzucndo3l9t49Xp4LUfTobx3jmUB9mELzfrQ9nz2n1hoj9/8916vLjhcfP3th2/OKjCmCOYAKJ3zjRzbx7fSUj2BG7k4DkfwYAkmqPY+PyWEUAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"full process\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-8d63b.png\\\"\\n        srcset=\\\"/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-16ce1.png 213w,\\n/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-898e7.png 425w,\\n/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-8d63b.png 850w,\\n/blog/static/full-process-ad6ebc3fa910f6637ef3239119e59e19-f06f1.png 1123w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<h2 id=\\\"构建cssom\\\"><a href=\\\"#%E6%9E%84%E5%BB%BAcssom\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>构建CSSOM</h2>\\n<p><em>CSSOM (CSS Object Model)</em>，CSS对象模型，构建过程类似DOM，当HTML解析中遇到<code class=\\\"language-text\\\">&lt;link&gt;</code>标签时，会请求对应的CSS文件，当CSS文件就位时，便开始解析它（如果遇到行内<code class=\\\"language-text\\\">&lt;style&gt;</code>时则直接解析），这一解析过程可以和构建DOM同时进行</p>\\n<p>假设有如下CSS代码</p>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"css\\\">\\n      <pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\">body</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">font-size</span><span class=\\\"token punctuation\\\">:</span> 16px <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">p</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">font-weight</span><span class=\\\"token punctuation\\\">:</span> bold <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">span</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">color</span><span class=\\\"token punctuation\\\">:</span> red <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">p span</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">display</span><span class=\\\"token punctuation\\\">:</span> none <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token selector\\\">img</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token property\\\">float</span><span class=\\\"token punctuation\\\">:</span> right <span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>构建出来的CSSOM是这样的</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-5a622.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 582px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 51.37457044673539%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACrElEQVQoz41SXUhTARS+booQ4UvZS9BDP1BQ0EMEQUHUS2FED4GRD4mkLKNRkssphT9kiYtS8KHQoh/oJSqNWTqVdd3mdbt/2737u7t3273uz825ueZw8+e0zepFH/rgwDmHw3fOd85BkDxIbvEWwfieUw6ph2B9Gto1N/QVh2OemZbTQUvTsGi6PRYg2jr1EwPlAAgCUF6C/AEk98siWH2pH2+XX3qysJm08fEJFy8BbuXSs5TbjdmCM+pxOPFFO3QhgClxVqcQveb290gllP8lOqSGUmQ7kHZJphndKJ3JwA4AkOetRMRbqgRM3Uugva1a/eieQt2ZbjhAor1Kj1H1CEdf1Ff3r1SO6j6epdHuN7yxeVAkumqbP6yVbWlw8qamIkyqyCVKkUxY70Voo+ZiIe/Eus7NWxQBYarmV5JW0AOD93dGyLuXo5aGORGtXYxSytdFApMjdYVwhNQmJtqixaI900zi8VsDHJ+efFaj1/W99M22NeBTrXtHLHB4Eg91fMd8AwZbrGnMsnDtJ5O5qqcT/eNksh93JjoMzMJ1hPGEjdnsCgSCIQhHIrCaywLBxTpjROM3aboOYoQSGFRVzfhX2/LrAEHwQnYlAywfWfJIcSyXzYAk+mF1bR1YIW5AzM64ysGHDDjj+4RZxfYxI1ffNw67CtMrB9CD++5IFQXfwi1XCVKMIu3iZ8wmPpywpqus3nQj54+N5BU+RalgtZnPHd2yw2E77LZ745N2bk5nsYenKGfwh0sImRhv6gHyP7B7gjLWRspIq7N4IVpYPrVRkMZzIPoFCIUCBaUghVNo8e/AVobTTrk3sCiTIilZUPLJPW6HzMV55WZ3WvaPmOKXioHeljriDyXnWacQp1leIFlBy3Dhd7SQvrFJOF9S9yqHnO9e33bA37RPvRr/HVl2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"cssom tree\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-5a622.png\\\"\\n        srcset=\\\"/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-f1daf.png 213w,\\n/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-a4e18.png 425w,\\n/blog/static/cssom-tree-341548d8f4cf8fb4d707a6ce9b8627e8-5a622.png 582w\\\"\\n        sizes=\\\"(max-width: 582px) 100vw, 582px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>需要注意的是，上面并不是一颗完整的CSSOM树，文档有一些默认的CSS样式，称作<em>user agent styles</em>，上面只展示了我们覆盖的部分</p>\\n<p>CSSOM的构建必须要获得一份完整的CSS文件，而不像DOM的构建是一个循序渐进的过程。因为我们知道，CSS文件中包含大量的样式，后面的样式会覆盖前面的样式，如果我们提前就构建CSSOM，可能会得到错误的结果</p>\\n<h2 id=\\\"构建render-tree\\\"><a href=\\\"#%E6%9E%84%E5%BB%BArender-tree\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>构建Render Tree</h2>\\n<p>这也是关键的一步，浏览器使用DOM和CSSOM构建出Render Tree。此时不像构建DOM一样把所有节点构建出来，浏览器只构建需要在屏幕上显示的部分，因此像<code class=\\\"language-text\\\">&lt;head&gt;</code>,<code class=\\\"language-text\\\">&lt;meta&gt;</code>这些标签就无需构建了。同时，对于<code class=\\\"language-text\\\">display: none</code>的元素，也无需构建</p>\\n<blockquote>\\n<p><code class=\\\"language-text\\\">display: none</code>告诉浏览器这个元素无需出现在Render Tree中，但是<code class=\\\"language-text\\\">visibility: hidden</code>只是隐藏了这个元素，但是元素还占空间，会影响到后面的<strong>Layout</strong>，因此仍然需要出现在Render Tree中</p>\\n</blockquote>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-c2ada.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 46.69565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACkUlEQVQoz3VQXUhTYRg+001tztLSwixoppSplDdelBQEsatuwwwUE6YozAqdM1D8I0mtTApTFywbiznNLFEcOrdz9uPOjmc7PztnZ39u07RA6yqii/jaWVHe9MAHz/N+Dw/v+0BQHAC4BVkHU3Jyz1xO5zVu6ZX5rO0T3PqzhP7tAYKKK9dOV966fYrXu2hNKojeT4H24wdIOCEGbm9jbN0K6C5I5ufI8uNKerVlfHxGGw8ECa+L3Sslue0pgo0NG+zfyiizUkmYOxR5w0CkGJwQbTrlkoTRh6juUGZVtxfpGCRsIwrW+aQm5Ggb085O5T6dB8dsFrUsaFfqvdgrqRn/cvwdEivkHN1qn1VZu2p8fpW09BgQWCcj4D4d4dRcgkJIczrQQAI3w+a56M2XTg/Z7lntnHOg8AOE2Bum1meqA5b6IdqLXcfIoNdFbqy50ekBEu7ReP3Rt5jHSxD+T2o3ydpRcmPxz/Gtgt14Rzyzu6N1iIt7bXayjfvraenXp1mxQMkyGj2P06EVxzpDod6dnvIGTjhv8WW+hyN5k/oFMdR6ryGpqbE+taS4KDM/X3r4YvmFND5A88acYYSJE7oP2JGFJeshF+Y+Fx8n8X8vpqmjI2pDZpwmF0glwsKTEmGcC8pKC4T7l8iIvyyR+IBwfgeI6dDnUSb4cdZBblUTvrAsEt1SU7GfUspULQGROjH0P1RVVUFyufyvXqTDBSs47FlCTYTWFr0ZRnu7IliXTrsSySkaBaLwmkobQ9se5ZtAsoVjs5doLnvShCc27+wf+Bd8o7Y20eEc7hevBYkKI02fpQI7Q24mOob7tvtcZFCP+r8XbzqaHkbszSojE1SYcDNjIp0GfPcrfx1kDbDQL+2RTlz0GRJmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"render tree construction\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-8d63b.png\\\"\\n        srcset=\\\"/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-16ce1.png 213w,\\n/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-898e7.png 425w,\\n/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-8d63b.png 850w,\\n/blog/static/render-tree-construction-0c389301ba794f3ca7b491572d73971d-c2ada.png 1150w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>构建过程遵循以下步骤</p>\\n<ol>\\n<li>浏览器从DOM树开始，遍历每一个“可见”节点</li>\\n<li>对于每一个\\\"可见\\\"节点，在CSSOM上找到匹配的样式并应用</li>\\n<li>生成Render Tree</li>\\n</ol>\\n<h3 id=\\\"扩展：css匹配规则为何从右向左\\\"><a href=\\\"#%E6%89%A9%E5%B1%95%EF%BC%9Acss%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%E4%B8%BA%E4%BD%95%E4%BB%8E%E5%8F%B3%E5%90%91%E5%B7%A6\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>扩展：CSS匹配规则为何从右向左</h3>\\n<p>相信大多数初学者都会认为CSS匹配是左向右的，其实恰恰相反。学习了CRP，也就不难理解为什么了。</p>\\n<p>CSS匹配就发生在Render Tree构建时（Chrome Dev Tools里叫做<em>Recalculate Style</em>），此时浏览器构建出了DOM，而且拿到了CSS样式，此时要做的就是把样式跟DOM上的节点对应上，浏览器为了提高性能需要做的就是快速匹配</p>\\n<p>首先要明确一点，浏览器此时是给一个\\\"可见\\\"节点找对应的规则，这和jQuery选择器不同，后者是使用一个规则去找对应的节点，这样从左到右或许更快。但是对于前者，由于CSS的庞大，一个CSS文件中或许有上千条规则，而且对于当前节点来说，大多数规则是匹配不上的，到此为止，稍微想一下就知道，如果从右开始匹配（也是从更精确的位置开始），能更快排除不合适的大部分节点，而如果从左开始，只有深入了才会发现匹配失败，如果大部分规则层级都比较深，就比较浪费资源了</p>\\n<p>除了上面这点，我们前面还提到DOM构建是\\\"循序渐进的\\\"，而且DOM不阻塞Render Tree构建（只有CSSOM阻塞），这样也是为了能让页面更早有元素呈现。考虑如下情况，如果我们此时构建的只是部分DOM，而此时CSSOM构建完成，浏览器此时需要构建Render Tree，如果对每一个节点，找到一条规则进行从左向右匹配，则必须要求其子元素甚至孙子元素都在DOM上（而此时DOM未构建完成），显然会匹配失败。如果反过来，我们只需要查找该元素的父元素或祖先元素（它们肯定在当前DOM中）</p>\\n<h2 id=\\\"layout\\\"><a href=\\\"#layout\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Layout</h2>\\n<p>我们现在为止已经得到了所有元素的自身信息，但是还不知道它们相对于Viewport的位置和大小，Layout这一过程需要计算的就是这两个信息</p>\\n<p>根据这两个信息，Layout输出元素的<em>Box Model</em>，关于这个，我也写过一篇文章<a href=\\\"https://tianzhich.github.io/blog/learning/2018/09/11/Document-Flow-and-the-CSS-Positioning/\\\"><em>Understand CSS Formatting Model</em></a></p>\\n<p>目前为止，现在我们已经拿到了元素相对于Viewport的详细信息，所有的值都已经计算为相对Viewport的精确像素大小和位置，就差显示了</p>\\n<h2 id=\\\"paint\\\"><a href=\\\"#paint\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Paint</h2>\\n<p>浏览器将每一个节点以像素显示在屏幕上，最终我们看到页面</p>\\n<p>这一过程需要的时间与文档大小，CSS应用样式的多少以及复杂度，还有设备自身都有关，例如对简单的颜色进行Paint是简单的，但是<code class=\\\"language-text\\\">box-shadow</code>进行paint则是复杂的</p>\\n<h2 id=\\\"引入javascript\\\"><a href=\\\"#%E5%BC%95%E5%85%A5javascript\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>引入JavaScript</h2>\\n<p>前面的过程都没有提到JavaScript，但在如今，JavaScript却是网页中不可缺的一部分。这里对它如何影响CRP做一个概要，具体细节我后面使用Chrome Dev Tools进行了测验</p>\\n<ol>\\n<li>解析HTML构建DOM时，遇到JavaScript会被阻塞</li>\\n<li>JavaScript执行会被CSSOM构建阻塞，也就是说，JavaScript必须等到CSS解析完成后才会执行（这只针对在头部放置<code class=\\\"language-text\\\">&lt;style&gt;</code>和<code class=\\\"language-text\\\">&lt;link&gt;</code>的情况，如果放在尾部，浏览器刚开始会使用<em>User Agent Style</em>构建CSSOM）</li>\\n<li>如果使用异步脚本，脚本的网络请求优先级降低，且网络请求期间不阻塞DOM构建，直到请求完成才开始执行脚本</li>\\n</ol>\\n<h2 id=\\\"使用chrome-dev-tools检测crp\\\"><a href=\\\"#%E4%BD%BF%E7%94%A8chrome-dev-tools%E6%A3%80%E6%B5%8Bcrp\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>使用Chrome Dev Tools检测CRP</h2>\\n<p>为了模拟真实网络情况，我把Demo部署到了我的<a href=\\\"https://tianzhich.github.io/Critical-Rendering-Path-Demo/\\\">githubpage</a>，你也可以在仓库找到<a href=\\\"https://github.com/tianzhich/Critical-Rendering-Path-Demo\\\">源代码</a></p>\\n<p><strong>同时，不要混淆DOM, CSSOM, Render Tree这三个概念，我刚开始就容易混淆DOM和Render Tree，这两个是不同的</strong></p>\\n<p><strong>下面的Chrome截图部分，如果不清晰，请直接点击图片查看原图</strong></p>\\n<h3 id=\\\"0-代码部分\\\"><a href=\\\"#0-%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>0. 代码部分</h3>\\n<h4 id=\\\"html\\\"><a href=\\\"#html\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>HTML</h4>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"html\\\">\\n      <pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>html</span><span class=\\\"token punctuation\\\">></span></span>\\n  \\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">charset</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>UTF-8<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>meta</span> <span class=\\\"token attr-name\\\">name</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>viewport<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">content</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>width=device-width, initial-scale=1.0<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>link</span> <span class=\\\"token attr-name\\\">rel</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>stylesheet<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>../css/main.css<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token punctuation\\\">/></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>title</span><span class=\\\"token punctuation\\\">></span></span>Critical Rendering Path with separate script file<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>title</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>p</span><span class=\\\"token punctuation\\\">></span></span>What's up? <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>span</span><span class=\\\"token punctuation\\\">></span></span>Bros. <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>span</span><span class=\\\"token punctuation\\\">></span></span>My name is tianzhich<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>p</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>div</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>img</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>../images/xiaoshuang.jpg<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">alt</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>小爽-流星雨<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">height</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>500<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n  <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;</span>script</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>../js/main.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script language-javascript\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n  \\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&lt;/</span>html</span><span class=\\\"token punctuation\\\">></span></span></code></pre>\\n      </div>\\n<h4 id=\\\"javascript\\\"><a href=\\\"#javascript\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>JavaScript</h4>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"javascript\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">var</span> span <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getElementsByTagName</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'span'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\nspan<span class=\\\"token punctuation\\\">.</span>textContent <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'Girls. '</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// change DOM text content</span>\\nspan<span class=\\\"token punctuation\\\">.</span>style<span class=\\\"token punctuation\\\">.</span>display <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'inline'</span><span class=\\\"token punctuation\\\">;</span>  <span class=\\\"token comment\\\">// change CSSOM property</span>\\n\\n<span class=\\\"token comment\\\">// create a new element, style it, and append it to the DOM</span>\\n<span class=\\\"token keyword\\\">var</span> loadTime <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nloadTime<span class=\\\"token punctuation\\\">.</span>textContent <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'You loaded this page on: '</span> <span class=\\\"token operator\\\">+</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nloadTime<span class=\\\"token punctuation\\\">.</span>style<span class=\\\"token punctuation\\\">.</span>color <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'blue'</span><span class=\\\"token punctuation\\\">;</span>\\ndocument<span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>loadTime<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<h4 id=\\\"css\\\"><a href=\\\"#css\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>CSS</h4>\\n<div class=\\\"gatsby-highlight\\\" data-language=\\\"css\\\">\\n      <pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token comment\\\">/* // [START full] */</span>\\n<span class=\\\"token selector\\\">body</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">font-size</span><span class=\\\"token punctuation\\\">:</span> 16px\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">p</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">font-weight</span><span class=\\\"token punctuation\\\">:</span> bold\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">span</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">color</span><span class=\\\"token punctuation\\\">:</span> red\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">p span</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">display</span><span class=\\\"token punctuation\\\">:</span> none\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\">img</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">float</span><span class=\\\"token punctuation\\\">:</span> right\\n<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token comment\\\">/* // [END full] */</span></code></pre>\\n      </div>\\n<h3 id=\\\"1-不加载js情况\\\"><a href=\\\"#1-%E4%B8%8D%E5%8A%A0%E8%BD%BDjs%E6%83%85%E5%86%B5\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>1. 不加载JS情况</h3>\\n<p>首先来看没有加载JS的情况</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACmElEQVQ4y5WTyW7TUBSGvUViUzWhNKoQEumWp2DVICGxg7DghTALHgVBM0ggKjopdkho7STN5NmJE89jbpJ7uHYqRAtdcKRPZ7o6Prb/SzXrn/c5jnnf6XVpnufpbrdDc50u3Wy1aZZlaZZh6GazSbdaLZrjOJrneHo0GtGSJNGiKGaQ+J0gCB8YhnlK1WrVF57vQhhF4HsehGEIjh+B7Xrguk6WZ5B+slhAFMcQE5IkIWziOI4AMIZ6vf6W+lStHYzHElaGfTRs/0DiVQ8poojGlxdIHfSRLClIUXVSk5HQ6SJVkJE+mSFVnSJN+02iaROoVCqvqAbTKCVhAEvTwEiXMRIHMP3ZBPn0CGbEe/0eWEMOxKtTaB9/hD53BKLQBGHMbrzAYnHErNaJD1y3W6ZqX09Kpu2B7QV4YnpY002YGTOYzy1wbJd8Bh9sy4UJqVm+DZqlgU4YKAOQDQnUuYK1ubJyIw++HX8vU5WjVilYAPgJYHHqYVGzQJt5aQ52sMxiw45hRpiaAVgugngJMLUimDsJGGaE3RCvMAAwbLtMHX45Kc2d9GCILS/Grh+DHy4giNBfpHU/2pDlmxiT+iqd2GpflKkGy5YM0wbP87Bt2zgIAvLDMKxWK1jfZn3NnzkZtU4DYpeXl2WK57gSQgiiKMKKqmIyGP7T0rfNBvJ8h2zYaBykWiJaWzuOsyaDbxDfyu9gSbYEIv7X1NnZ2fOACDdJFrBY3CR7UBSn218L+d+k51I7Pz9/Qx0eVp51elemLMuGLEmGqqqGrusZoiAY/eHYGI5GRtZXlI2/haIoE3L9vGq1+pLK5R/ce/xo70k+l9vP5XLF7e3t4tbWVsbOzk5xr/CwWNjdJfVN7y7y+XyxUCjc/wWNdm5DH/XtDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-16ce1.png 213w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-898e7.png 425w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png 850w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-c39de.png 1275w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-12da9.png 1700w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-894f8.png 2550w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>上图中，浏览器收到HTML文件后，便开始解析构建DOM。</p>\\n<p><strong>需要注意，上图接收的只是图片的一部分</strong></p>\\n<p>接下来我们详细看看这三个部分</p>\\n<h4 id=\\\"dom构建体现为parse-html\\\"><a href=\\\"#dom%E6%9E%84%E5%BB%BA%E4%BD%93%E7%8E%B0%E4%B8%BAparse-html\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>DOM构建(体现为parse html)</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACe0lEQVQ4y5WTSW/TUBCAfUXiQmhDSMWJ9Mqv4NQgIXGDcOAPYQ78FA5JAwIKNAk0Tt00a3FSL4mTOkvrxPvyhnkvlqhAquDJn2bV2J55wzU+FHc7HeFNt9/jO50O3+v1+Ha3xx+LJ7wgCLxQr/ONRoMXRZHFKcPhkFdVlVcUhYH6a1mW39br9UdcqVh8enm5BNuxwTRNsG0LrtYOLK5WiW2D4zgM13UZnueB7/sMqlPoKZfLr7h3xf29fl8imjYKFEUNVE0LFFUNqL3RNZSjRGqBnOTIisJ06kfpjcc6Fnz/nBOEej4OfaxPSAI+IdoxEqEIroH+KNjEWE5IJcFYRL8Q21Hgyp8q+WNpBofdC3IoyqTSHEHl7BK+tg04ak9AOLegIVtwrNiYM4ODpg7VEwWE/gJq/TUcSRYRZCcaziOoVqsFbv+LmJ+vCUzNiJyrMzJQDNDNGKSJBdJAh/EyAAPjF6uY5sD0KgRF1uG0qUBNuICBZBJj7kRrbKMgnha44sdafmnaOBSXWI5PbNcHxw3A9iLw8W9cLwTHCxhUp9gUzHPZUHziOn4UY6fEZqvAfa58z0+MOZgri4RhSIEoijZc168RJyQ2ieOY9bDVwoInwo/8bG7CwvSI63msIMHZ/AdU/B7Kt4P6Xq21hL5ux7PpJF4slnS8MWbFyaj/BTpy6Ha7L7jD2tGTtmbDwmIv+ePgjcDmxPQ23XBIEsdtesmVSqXHkvRzMR5pBq6QMRqNDF3XGbJ8bpxJQ2MwGBoaxjRN+wt145/iCq6w1jMudTd9615m5+Gd1Nbu9vZ2bmtrK5dKpRiZTCb3YOd+biebZf6bSKfTuWw2e/sXqG5x/MfO0xkAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script2\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-16ce1.png 213w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-898e7.png 425w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-8d63b.png 850w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-c39de.png 1275w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-12da9.png 1700w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-894f8.png 2550w,\\n/blog/static/without-script2-f0e964816e3382dbc8de25141bcc6df5-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>可以看出，浏览器解析到<code class=\\\"language-text\\\">&lt;link&gt;</code>，<code class=\\\"language-text\\\">&lt;img&gt;</code>等等标签时，会马上发出HTTP请求，而且解析也将继续进行，解析完成后会触发<a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState\\\">readystatechange</a>事件和<a href=\\\"https://developer.mozilla.org/en-US/docs/Web/Events/DOMContentLoaded\\\">DOMContentLoaded</a>事件，在上图中，由于时间间隔已经到了100微秒级别，事件间隔有些许差异，但不影响我们对这一过程的理解</p>\\n<p>细心的话可能会注意到上图中还触发了Recalculate Style (紫色部分)，这一过程发生在CSSOM树构建完成或者发生变化需要更新Render Tree时，但是此时我们并没有拿到CSS，更没有构建出CSSOM，这一部分从何而来呢？我在下面第4部分做了分析</p>\\n<h4 id=\\\"页面首次出现画面\\\"><a href=\\\"#%E9%A1%B5%E9%9D%A2%E9%A6%96%E6%AC%A1%E5%87%BA%E7%8E%B0%E7%94%BB%E9%9D%A2\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>页面首次出现画面</h4>\\n<p>下面这一过程依次展示了CSS解析构建CSSOM，Render Tree生成，layout和paint，最终页面首次出现画面</p>\\n<p>下图中有一点错误：<strong>render tree构建应该发生在Recalculate Style (layout前一部分)，Layout以及后一部分Update Layer Tree作为Layout</strong></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACnElEQVQ4y3WTzW7TQBDHfUXiUjWhNKoQEumVp+DUICFxg3DghXAPvAQSJySUkFRC0AqIQhJSQdK0SdzE33bs+GNtx3GTHcbbBpVAV/ppZuc/O7tez3Ktg/Jup9vcPznt8d1ul+/1enznpMe32sd8s9nkm40G32q1+Ha7zfQUQRB4URT58XjMQP/VaDR63Wg0HnKVSvmJ49oQhiF4ngdBEIDjB2C5Hriuy+apFkYhRFHEmMUziOcxxHHM/NlsBpRSqFarL7l370t7g7MhVRUlkSQ5UWQ10RSNoatGosoaQ1lZSb1m1ZUe65oB1crBM+7tm1JBFBVwiU39wKWmr4Ew6cPIGsA52pTxdIAMYWQjlgBj+5zlXOlUMM8WeqDAt+aXIlc6OCwYlgNT16eG7dGRYYE20UGzJjAlHn46gUHfgP6pBrJswNgUQFD74OL1TAMCTkCoEwaLMJnDp6OjIlc9bBfCOUCUAHXJBVU1G/SJi/c4h+gCwJlGMJ1E4NkxODJuYnvgWHi3lo/3umTrkMUSAJo/fha58sdaYeIE4JGImnjCsaiCbthgOT4QzBRlLT09BHEChmnhZvg1DgEbdT+YQRAlFPMWCwrQPsaCn7/WC4pugu8TejUgHaldLpf/+Kv5Koagu1yk8U7nV5H7Xq8XAkLA9SOKvz8FrsPaZC22Bq6JWUHs1SJXq9X2CBYkxF9iH/6F7/t/WNfW8i7SnsTGfp4WfByGETbqnDXqHG2SJIx0Hs1idpI0fhNpXjrq9foLrlT+8Ojk9MyWJMmUJNGUZdlUVdXUNM3E52T2h+fmUBDMS/3/4Bodn6BfqVSecpnsnVv37+08yGYyu5lMJr+5uZnf2NhgbG1t5Xdyd/O57W2MX2o3kc1m87lc7vZvCwZtCjzzg/4AAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script3\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-16ce1.png 213w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-898e7.png 425w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-8d63b.png 850w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-c39de.png 1275w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-12da9.png 1700w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-894f8.png 2550w,\\n/blog/static/without-script3-8caf62e116b5626b2ebafc051278ffa6-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>从这里我们可以看出，DOM即使构建完成，也需要等CSSOM构建完成，才能经过一个完整的CRP并呈现画面，因此为了画面尽快呈现，我们需要尽早构建出CSSOM，比如</p>\\n<ol>\\n<li>html文档中的<code class=\\\"language-text\\\">&lt;style&gt;</code>或者<code class=\\\"language-text\\\">&lt;link&gt;</code>标签应该放在<code class=\\\"language-text\\\">&lt;head&gt;</code>里并尽早发现被解析（第4部分我会分析将这两个标签放在html文档后面造成的影响）</li>\\n<li>减少第一次请求的CSS文件大小</li>\\n<li>甚至可以将最重要部分的CSS Rule以<code class=\\\"language-text\\\">&lt;style&gt;</code>标签发在<code class=\\\"language-text\\\">&lt;head&gt;</code>里，无需网络请求</li>\\n</ol>\\n<h4 id=\\\"页面首次出现图片\\\"><a href=\\\"#%E9%A1%B5%E9%9D%A2%E9%A6%96%E6%AC%A1%E5%87%BA%E7%8E%B0%E5%9B%BE%E7%89%87\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>页面首次出现图片</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACt0lEQVQ4y52Ty27TUBCGvUVi0zZRaAQIiXTLU7BKKyGxg7DghTALFjwCrKClJQlpoVBVFDUX5SI7t9qJnTgXO3YSO77Exz7DsUnKBlgw0ifPnPk9Gs8ZU8VceodhCi/ZRoNmWZZuNOo0U2/QpXKFLhaLdKFQoEulEl0ul2mGYUINz/O0KIq0IAhrXnQ7nVf5/OUD6jiXfaQbM7AsC/S5DpZpwtywQJsbYWySOMgF2LYd4jgOLJfLkMC3CRgAcicnz6mjbDrZbrewKAqusEboumJP/B0T+v2+2+ut6V3TlyS3z3POqMlCbv/dE+ro9DDZHDSAG7cwN27ijnoFfIDSAi5g0oL+VATkI3BcG1zkgut64Ngu6d4hLLG79DwwF5C/OE9Rnw6O9gYCB9K4hyVVwSzfBEFswXCqwFAdgzTqgzwZwlgZgOZYoPSrINQ/AtfIQKd+AHx9HyvSsSddncHBm7cp6vDDl11lqIGqmXhBRjGU5zAaqGC5ALJqkuIKKIoOkjQBwwGwphPgW9+hcPYaODYDzGUG18qnnjbkoXryOUVlvl4kNaLUTQdPdRPPSVXT8WBBKho2grmFSIzCMyP4zKkOi6kNrVoFpKsOSBfv8bh26SHVgOrZaYo6Pf+2O54o5LZs7HkIIzIjn4zE971fzxVeeOaDjxCBtE+uFQcajPBMkz2ka8AybIoiu7a7mC3ANuzg5gNCw3gNXrHyV6JrnxhCyAveYev1FPUj/yNZE8sgz0a+bui+NtVIc75PdCFEF7KO/wTJo7Agyz6lcufZPWZYBUnvhZ35Yf7/rFKpPKPS6ezDerOtkoWVyaLKkiTJg8EgpNvtym2uI3McH+b+wYj8fno2m31MRaKxG/fu3rkfiUR2CInNzc3ExsZGSCwWS9yO30rEt7cTW1sRwtZfiUajiXg8fvMnl1BqSDcXvsMAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script4\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-16ce1.png 213w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-898e7.png 425w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-8d63b.png 850w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-c39de.png 1275w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-12da9.png 1700w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-894f8.png 2550w,\\n/blog/static/without-script4-2ff07d9fdc2c64df19d3924874b8ab6e-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>上图说明，浏览器接收到部分图片字节后，便开始渲染了，而不是等整张图片接收完成才开始渲染，至于渲染次数，本例中的图片大小为90KB左右，传输了6次，渲染了2次。我觉得这应该和网络拥塞程度以及图片大小等因素有关</p>\\n<p>还有一点需要注意，两次渲染中，只有首次渲染引发了Layout和之后的Update Layer Tree，而第二次渲染只有Update Layer Tree，我猜想对于图片来说，浏览器第一次渲染便知道了其大小，所以重新进行Layout并留出足够空间，之后的渲染只需要在该空间上进行paint即可。整张图片加载完毕之后，触发Load事件</p>\\n<p><strong>上图包括之后图片中的Chrome扩展脚本可以忽视</strong>，虽然使用了隐私模式做测验（避免缓存和一些扩展脚本的影响），但我发现还是有一个脚本无法去除，虽然这不影响测验结果</p>\\n<p>接下来我们考虑JavaScript脚本对CRP的影响</p>\\n<h3 id=\\\"2-引入js\\\"><a href=\\\"#2-%E5%BC%95%E5%85%A5js\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>2. 引入JS</h3>\\n<h4 id=\\\"行内script-script位于html尾部\\\"><a href=\\\"#%E8%A1%8C%E5%86%85script-script%E4%BD%8D%E4%BA%8Ehtml%E5%B0%BE%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>行内Script (Script位于html尾部)</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACkUlEQVQ4y5WTSW/TQBSAfUXiUjWhNKoQEumVX8GpQULiBuHAH8Ic+B/tpZBGgQub2uyUNEtpNtuptzhOxh4viT2P50mDhFQOjPT5rfPsmfcs1EqF/Var8rbT64mddkfsdrviRacrNs9/irVaTaxWq2K9XhebzabYbrc5w+FQlCRJHI/HHNTfjEajd5VK5bFQKp48c1wCxHFgbttAqQtzh4K1ILBYzMFFm3oUPM8D3/c5QRBAGIZIwPXExxiDUqn0Wnh/8uFgMBgySVKWiiQvFWWyVGSFM0FdQp+MsYS1Lv/ROWM5yQ0wFwt+fCFUq+VcgG+w7AWTlAnTDBNs4nDmiONSIMiC2wTsxQ2oWzYB3VwwuvQjAAYXF+d54eiomJP6MhBVZaams6mqgaUbYJtTmM9s6F0N4Wqs4EYLTLR9xwUPi3NJPXDNKXOky0jSZnB4/CUvHB5/zkljDTTNYubMZdRnQGgEjrdG1my4tnBjwMC0PZjgRt0koKgWaNdTcMw58zQtsnUKX7818kLh0/ecMSMwnTvMJh4jNADXXyIroAlhDMRb64SGeGwPm+ZzVH0K3cs+s671CKIYGj9aeaFar+d0y8aOEmbPZszFbjMWQxRFECMbyYljHtvIpLPYZYbdxjsEaLWwID5yq9UKgjBkGt4hpRT+czGEF8QZzQvlcvkgmTEkxmLxRq7xuP2371ZWyUkajcZL4fT09KmLX5UMKB/YILwZ2pAPLPV8PtSb+G0keck6Ozt7JRQKJ086vUtLlmUjYTKZGKqqcsajkfGrPzT6g4Gxid+Goiga/n6kWCw+F1Lpe3cePth7lE6l9lOpVHZ7ezu7tbXF2dnZye5l7mczu7voX8f+RTqdzmYymbu/AbtmcG4XVYZ2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"inline script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-8d63b.png\\\"\\n        srcset=\\\"/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-16ce1.png 213w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-898e7.png 425w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-8d63b.png 850w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-c39de.png 1275w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-12da9.png 1700w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-894f8.png 2550w,\\n/blog/static/inline-script1-1c09b0e39fa9c2dba2b52eff19028a03-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>上图来看，Parse HTML这一过程被JavaScript执行打断，而且JavaScript会等待CSSOM构建完成之后再执行，执行完成之后，DOM继续构建</p>\\n<p>前面的例子中，我们看到DOM几乎都是在CSSOM构建完成前就构建完成了，而引入JS后，DOM构建被JS执行打断，而JS执行又必须等CSSOM构建完毕，这无疑延长了第一次CRP时间，让页面首次出现画面的时间更长</p>\\n<p>如果使用外部script脚本，这一时间会更长</p>\\n<h4 id=\\\"外部script-script位于html尾部\\\"><a href=\\\"#%E5%A4%96%E9%83%A8script-script%E4%BD%8D%E4%BA%8Ehtml%E5%B0%BE%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>外部Script (Script位于html尾部)</h4>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACrklEQVQ4y3WTS2/TQBDHfUXiUjWhNKoQEumVT8GpQULiBuHAF8Ic+BYcobRJ0wMSB9o0aYJKkj7yauJHsn6vH2s79g5jR0KigKWfZnZeGmv/K7Qbh7s/e633/cuBeHFxIQ4GA7F/eSW2O12x1WqJ7VZbPD8/F7vdrtjv98VerycOh0NxNpuJt7e3Oei/m06nH7D+qXB8VH9BqQ1htIJVkgJjAZiOC7pNwbZt8DwPfN/PCYIghzEGYRgCC1nuB9jDOYdGo/FW+FI72BtPplzTaRwnPHYsO57P57GiKLEkybEsK3iWYkmW1xZj0lyOFVmNFUmNVXmREarKAur1+iuh0/1RUWUJRsNLrmkqd10LlkQGFnngMYq4ufUD9JEAsXwTJtpNzphcc7QJcRU4bTarwvHnWkWdyzAZTbgqSZyoC9AWSzCWBDSLAg0Y+NQD11gC1We5T3UNdIOAbRlg6ITbjpl4jglfa/tV4ejjp4rrp0AZcM1wuU0j8EIAx/TAdBMIVgCBtwLXZ2A5Rn72iYkbp0A0CurCynoSjvF2o1EV6vvHFX2pg62Z3DGsDPDwQlzE8XA4w2GmDYqkwGw6A9OwwTfMdR59Wzc5tZwkYRF0T/GXv31vV+QFAYc6PMWrStIE0K5JU7RIFEHs0ZzE94An6xoOkIEeJOhCr9+vCmdnzYrnupkseMgYz2TwFyiREIdmsDC6m8968oHdTqcqnJyc7Lk4EEkdx/kDSulv7ubu1K0yXaKwX2cDn/t+AFG2AQYzG8dxTnYOWJhvksX/R1aXfc1m841wcFh7Nri6NlDMZD6fEUmSCIqaqKpK8DmRm9GEjMZjss7/G+xZ4BOkKOyXQqH44N7jRztPioXCbqFQKG9ubpY3NjZytra2yjulh+XS9jbG17n/USwWy6VS6f4vT4puyFGkYREAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"separate script file1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-8d63b.png\\\"\\n        srcset=\\\"/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-16ce1.png 213w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-898e7.png 425w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-8d63b.png 850w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-c39de.png 1275w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-12da9.png 1700w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-894f8.png 2550w,\\n/blog/static/separate-script-file1-0cc2d40af4969a48c960e6d4098be0db-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>对于网络请求的资源，浏览器会为其分配优先级，优先级越高的资源响应速度更快，时间更短，在这个例子中，CSS的优先级最高，其次是JS，优先级最低的是图片</p>\\n<p>我们主要来看第一部分，后面部分和第1个研究类似</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACkklEQVQ4y5WTS2/TQBCAfUXiUjWhNKoQEumVX8GpQULiBuHAH8Ic+CNcSh2FUx+oTdIoFc2jtE0cv+PE9Wv9jL3DrEMrQPTASp9mxzM7npmd5U6be9vn/c7H4cWIHw4G/Gg04gfDC/602+M7nU5Bt9vle70eP0B7v9/nr66ueEmS+Ol0WoD7D6IofkLf51yzIbzyfRd8EoBtO+D7HtgeAcv1wHVdIIRAEAQQhoywII4jiJMY5YooioBSCs1m8z23K+ztTCYTKopqKit6qioaoqbSVE5FUUoV1BmSpBRSltViv0K+JcYzIAjCG67dOqklMf41iqksSXQ8vgTD0MA0dZAVEXRdhfncAMexQNPkAtMwUTcgiH0IE0KRLM0TOPp2WOc+C/u1iWaD64d0trCoNjNhbt2A47ngYalzm7WDQIil+ah72BqCZZMoxNbYMFVtOrO8LMlz2D84qnO7X09qzsKHwIspQUI/AXPhgWzcIA5IMw+DBqCjz8zCfpIUAvQJyRLcmQWGlVIvgiwFgE73rM4JzcOatbDBcQm1HZ+iZNmC7QZwg8wdgtkGd/gkwouKUMZA0C+IUkqiZbbMAXpn3+vcwVG7pmJP8EYpW1mWFTd2C/y2Z+RYWk7zX7LQKc3zDBOEfv+8zrXbrRrxfTYaFEeAshH4T/BMXATEWa1zx8fHOz4GRHLM8g88z7vjb9tffks2jzjYb1nAl0EQQpIkxZAymaZpAdPDaDW47Pt9MD+2Wq3WO+7LnvBiePHDkmXZlGXJVBTF1DTN1HXdxOdkXl5PzOvx2FzZ/w2eMfAJeo1G4zVXKj968PTJ1rNyqbRdKpWq6+vr1bW1tYKNjY3qVuVxtbK5id9Xtvsol8vVSqXy8CcW3W+pIzih7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"separate script file2\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-8d63b.png\\\"\\n        srcset=\\\"/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-16ce1.png 213w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-898e7.png 425w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-8d63b.png 850w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-c39de.png 1275w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-12da9.png 1700w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-894f8.png 2550w,\\n/blog/static/separate-script-file2-09073a1ad225a4acef44ad67fd673a85-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>可以看到，增加了对JS文件的网络请求时间，一轮CRP时间更长了，对比上面的行内Script可能时间差异没有那么明显，是因为这个例子中的JS文件体积小，传输时间只比CSS多一点，主要决定JS何时执行的还是CSS，如果JS稍大，由于请求优先级低于CSS，则差异会明显变大</p>\\n<h3 id=\\\"3-async-script\\\"><a href=\\\"#3-async-script\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>3. Async Script</h3>\\n<p>如果Script会对页面首次渲染造成这么大的影响，有没有什么好的办法解决它呢？</p>\\n<p>答案是肯定的，就是使用异步脚本<code class=\\\"language-text\\\">&lt;script src=&quot;&quot; async /&gt;</code></p>\\n<p>使用异步脚本，其实就是告诉浏览器几件事</p>\\n<ol>\\n<li>无需阻塞DOM，在对Script执行网络请求期间可以继续构建DOM，直到拿到Script之后再去执行</li>\\n<li>将该Script的网络请求优先级降低，延长响应时间</li>\\n</ol>\\n<p>需要注意如下几点</p>\\n<ol>\\n<li>异步脚本是网络请求期间不阻塞DOM，拿到脚本之后马上执行，执行时还是会阻塞DOM，但是由于响应时间被延长，此时往往DOM已经构建完毕（下面的测验图片将会看到，CSSOM也已经构建完毕而且页面很快就发生第一次渲染），异步脚本的执行发生在第一次渲染之后</li>\\n<li>只有外部脚本可以使用<code class=\\\"language-text\\\">async</code>关键字变成异步，而且注意其与延迟脚本 (<code class=\\\"language-text\\\">&lt;script defer&gt;</code>)的区别，后者是在Document被解析完毕而DOMContentLoaded事件触发之前执行，前者则是在下载完毕后执行</li>\\n<li>对于使用<code class=\\\"language-text\\\">document.createElement</code>创建的<code class=\\\"language-text\\\">&lt;script&gt;</code>，默认就是异步脚本</li>\\n</ol>\\n<p>直接看图</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACrElEQVQ4y5WTSW/TQBTHfUXiQNW0JRVISKRXPgWnBgmJG4QDXwhz4HPQA2pLm96AUqI0hRRna5Y63u3ENt4Sx3Hmz3NYhQSIZ/301nkezbzhauX9rUbj9Fmz3ebbrRbf6XT4RrPNnwsNXhAE/qx2tuTjhw98s9nkB4MBL0kSPxwOf+WpKIrPq9XqHa5cPrjv+S6iKEIYBphOJ/CCCI4XIPB9ioWUC5f5yWSCaTxFHMc/yPxsDaOvfHT0hNs9KG/3eiJTFC1RVD2RSUuSQqiJJGuJphmJrlmJrpqJqY9IG0tbI60pX20i1lQN+3t7D7lK9bRouhHafYmdnjfZebuH9uUQkmlDNsdQRxcQxHP0TAHC8BRd0v1RA12DYsSFXmd981M6xwzvq7USt/PioKgNFBiqwi76AyZKMszRGCPbhmuaUC97MMQO5LGMS62HXrcORe9CczUYvgHV1Zjuqmmgd/B6d6fEvdx7WzSUERw7YG6YMtuLYdoRZN2BqliwDAe26cL1EoQTBrEjwnPoLBPAdmM4/pw59iQNFA2V129K3O7Ru6Ksj6EbFjNHDtPNEWzHg/05IOgyZinCmKAOwWSGIJ6TP4cfxfSTkC4vZK4fpdMUqNU/lbjj4wo1tGHZIfPCOZFQ8RzzdAHGFkjpdNI0XbL4xg97schgJNQOEARqeHZWK47HNjw/ZAxgVIOM/xBahmXDVqtV4iqVyvZn181mbjGL40X8nen0p/1v5rRL1Ov1R9zJycm9aDLFbDajAf06tJn93Y9omLOB/nWYfyery4Q295jbf3Vwt9W5sCVZtmRCVVVL1/UlQ1G0uv1Lqz8YLHN/QlEUg56ff3h4+IDL5dav3Lp543Yul9siCqurq4WVlRXiWmF9Y6NwY/N6YTOfX8b/xtraWiGfz1/9AgBebBrIQTHSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"async script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-8d63b.png\\\"\\n        srcset=\\\"/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-16ce1.png 213w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-898e7.png 425w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-8d63b.png 850w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-c39de.png 1275w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-12da9.png 1700w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-894f8.png 2550w,\\n/blog/static/async-script1-e2672a947b0e181cdb84773dc873fd91-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACx0lEQVQ4y32STW8SURSGZ2vipilYJcaYiFt/hSsxMXGndeEfcly4cmP8BWo0toLWalMt1BakAgOY4jAfgMDwMd9zmbmvZ6a1RqPe5MnJec/NmXPmvkL59frlemP/vtRqic1mU2xRrEtN8aBWF+v1ulgulxM+Vz6LjUZD7HQ6oqIoYrfbPYHye7IsP9jb27si5PPrN6YzA47jwLZteJ6LmeVgMrdgmmaiO64Ll/A8D77vIwiC34g1gKNQKNwVnrx4ca3dbHJd1ZiaoBIK0yhq2lGuaeqxrjKa5iQqdI8mZF256+u9ftzwllAs7uRc+jILGfeZx9ligUUIyjkYC4kIQUwQ/iLJIywWHHPL5fZ0FCIK8KVeWxXyhc2cLksYjHTeM8Zcae/gsPoMqrSG7/ImvnffYKy9xVh/R2xhpG6QnofRi7UNTLQ3XGtLoTHSsf1ha1V4vbmb05Qe5mbAHR98OlAw0GuYDCSMJgqk5jYOio9R332E1qeHaFef4ltrAwell6h9WoNUfc9n/VEYehzlajzhZjHXH1uY0ujzucXNyRweAxy6YDshLDOEqoyxt/MRxa0C5I4Oc+JDq9D05ecYtSXuTs0wol9UOaCG2x9KOaU3ppVNPrMCPjHmmBkzMNtC5NqIPBsIXCzolZnrgQceQtdCYM8ROCYC0+DBhP4hnVqNGlYq+7mxYdDKNuf09hEVYv53wiiCaVmwyGamaXHHspKG5ONVoVTavTabTmk1MwoCP/J97wgvjv4vvCPNO9YZPT+jp04iY4u4YbVavU22KV53aJXYoH8aN85/mjrW/0Z8J67Hp1Qq3RHW1l9dbbTahqKqQzLsUNf1Yb/fT+jK8vDr4bfhYaeT1MjoJ/Enx/mAjG7m8/mbQip95tTFC+cvpVOpy6lUKru8vJxdWlpKWFlZyZ7PnM1mzp0j/aj2L9LpdDaTyZz+ARbmZ7KZk4J/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"async script2\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-8d63b.png\\\"\\n        srcset=\\\"/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-16ce1.png 213w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-898e7.png 425w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-8d63b.png 850w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-c39de.png 1275w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-12da9.png 1700w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-894f8.png 2550w,\\n/blog/static/async-script2-9e74f3cd580f15b1970472835b12101f-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>由于Script执行修改了DOM和CSSOM，因此重新经过Recalculate Style生成Render Tree，重新计算Layout，重新Paint，最终呈现页面。由于这一过程仍然很快（只用了140ms左右），因此我们还是察觉不到这个变化</p>\\n<h3 id=\\\"4-css在html中不同位置的影响\\\"><a href=\\\"#4-css%E5%9C%A8html%E4%B8%AD%E4%B8%8D%E5%90%8C%E4%BD%8D%E7%BD%AE%E7%9A%84%E5%BD%B1%E5%93%8D\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>4. CSS在HTML中不同位置的影响</h3>\\n<p>前面留下了一个问题，CSSOM没有构建完成，为什么刚开始的Parse HTML同时就有Recalculate Style这部分？或许这部分会给你一个答案</p>\\n<p>这里为了避免JS带来的影响，使对比更有针对性，删除了JavaScript</p>\\n<h4 id=\\\"设置style在html文件头部\\\"><a href=\\\"#%E8%AE%BE%E7%BD%AEstyle%E5%9C%A8html%E6%96%87%E4%BB%B6%E5%A4%B4%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>设置style在html文件头部</h4>\\n<p>先来回顾一下在头部设置<code class=\\\"language-text\\\">&lt;link&gt;</code></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACmElEQVQ4y5WTyW7TUBSGvUViUzWhNKoQEumWp2DVICGxg7DghTALHgVBM0ggKjopdkho7STN5NmJE89jbpJ7uHYqRAtdcKRPZ7o6Prb/SzXrn/c5jnnf6XVpnufpbrdDc50u3Wy1aZZlaZZh6GazSbdaLZrjOJrneHo0GtGSJNGiKGaQ+J0gCB8YhnlK1WrVF57vQhhF4HsehGEIjh+B7Xrguk6WZ5B+slhAFMcQE5IkIWziOI4AMIZ6vf6W+lStHYzHElaGfTRs/0DiVQ8poojGlxdIHfSRLClIUXVSk5HQ6SJVkJE+mSFVnSJN+02iaROoVCqvqAbTKCVhAEvTwEiXMRIHMP3ZBPn0CGbEe/0eWEMOxKtTaB9/hD53BKLQBGHMbrzAYnHErNaJD1y3W6ZqX09Kpu2B7QV4YnpY002YGTOYzy1wbJd8Bh9sy4UJqVm+DZqlgU4YKAOQDQnUuYK1ubJyIw++HX8vU5WjVilYAPgJYHHqYVGzQJt5aQ52sMxiw45hRpiaAVgugngJMLUimDsJGGaE3RCvMAAwbLtMHX45Kc2d9GCILS/Grh+DHy4giNBfpHU/2pDlmxiT+iqd2GpflKkGy5YM0wbP87Bt2zgIAvLDMKxWK1jfZn3NnzkZtU4DYpeXl2WK57gSQgiiKMKKqmIyGP7T0rfNBvJ8h2zYaBykWiJaWzuOsyaDbxDfyu9gSbYEIv7X1NnZ2fOACDdJFrBY3CR7UBSn218L+d+k51I7Pz9/Qx0eVp51elemLMuGLEmGqqqGrusZoiAY/eHYGI5GRtZXlI2/haIoE3L9vGq1+pLK5R/ce/xo70k+l9vP5XLF7e3t4tbWVsbOzk5xr/CwWNjdJfVN7y7y+XyxUCjc/wWNdm5DH/XtDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script1\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-16ce1.png 213w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-898e7.png 425w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-8d63b.png 850w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-c39de.png 1275w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-12da9.png 1700w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-894f8.png 2550w,\\n/blog/static/without-script1-781dc26a0641c9e0691481f3613ecdbf-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<span>link tag on top of html file</span></p>\\n<p>前面的DOM构建部分出现了Recalculate Style，之后获得CSS并解析后还有一次，一共出现了<strong>2次</strong></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACU0lEQVQ4y5XSW28SQRQA4H01MaHUn2D76q/wqZiY+Kb44B9yffCXmJgWrSa2SrfIRaAFSrehLGyhsOWy991Z5hzPjIW0jZc4yZczl7Mzk9mjVD7tbDYapTetdls9OTlR2xSbrbb6o1pTy+WyVKlU1Gq1qjabTanT6ai9Xk81DEOi/utut/u2VCo9UnI720/n9hw930PXdTAMApy7AU7mDtq2jb7vo09zAQnDUIqiCOM4lkRfAETc3d19pbx7v72ln3Whb5rMMHrM6PUYncj6/T4xr8f9W9Gg2DWMVT6JTPMCc7ncc+VQ0zIsjmh/cQgH5AkugbBgyK/BnYhciIHGC7FBvV7PKvvfCpnzwRRr+gjq+iUcda7w+HwqtU0X9WGApwNf0knrwsf2IMCzoYdHpxbWW2PQB8HCDREPtYOs8vFrNTPzOVp2AmObgeUkuHTlcpx4fBWFoU25LuDMY9jpTFA/ncLUh0VId8xrhazyYa+U8WPAgG7uhQvwIi766C/ReCkg84CjyBFrIQOMGAc/ggU9ElbrDbrhZy1jDsc4nc3B8wPwvID+Gvu9mGEY/RJFqz7QvHzDWo3e8HuxnJlNZxhNLKC/AAAcOf8vQOSGjcZxVikUClsO1ZsznXCqu1scx+EucW6w745tGRNRi8Vi8YWSzx88mTkuxiyRhZokiTyZriqL2KEn8Ki4GWN/JL4TTdO0l8qXvf3Hw+HlZHyjWZYljUaj8SUR8R+N0kZOPp9/pqTTqXsP1tcfrq2tbZKNVCq1kk6nN2htY52Itb8RuRTv/wSx5HL5YrXK7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"without script5\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-8d63b.png\\\"\\n        srcset=\\\"/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-16ce1.png 213w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-898e7.png 425w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-8d63b.png 850w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-c39de.png 1275w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-12da9.png 1700w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-894f8.png 2550w,\\n/blog/static/without-script5-9d6eea722410e9603d15b707c9c29452-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>再来看看改成<code class=\\\"language-text\\\">&lt;style&gt;</code>，Recalculate Style一共出现1次</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACe0lEQVQ4y5WSzW7TQBDHfUVCSlMegfbKU3BqkJC4QTjwQpgDrwJKhAiipWkoidMk4MSVSvBH0iZ2E3fXXn+s7R1mHQoCiSJW+mlmPB/r3f0r/beN3fG492JyeqpOxhPVMAxVnxjqyXCkapqm9no9td/vq4PBQB2Px6qu6+p0OlVt21YtyypB/7lpmi+73e49pdl4/dC/8iFkDK58HxgL4SpgsCIUCCEYM4iiqCSO45IkSSBNU0iTtPQlcrVarWfKq0Zz7+yrJRzH4TNnxi3b4Q5a3JXP53NuWTaXOdOyNta0uP0jvraWbSfObAbNZvOxomm9WpFznC/Ehlz6IIociqIAGhKgbA0+XUHEQ4izENIshjAOgCUYp5HgWSqbYDA8qSuNVrumT10YnS2F5NPEgw+fXRh+9XAYNjIO5hkFz03AXTL0CZgLByheQZIW4HhzYZwb+UWwgMN2p640909ql0EOHsnEZcCF8S0E7ZSA7RJYExyI1+NT/FMmgCBrksM6TCFIBLAUcywVqzDKWS7g8Oi4rrw50GoRnjhKhQjjQiQZFmIsBzFsCuICGwXGBSJKX37H2k0uEQIH54U88kjHge86NefchdXaFyGLRBDiq8YpxOULcjwW/2X/9DexQFve4XA4qivdbq+2RrlEEZ4HX0M+xH8ie8qBuv6lrhwff9yjlEIQBAXq7jfwexEg9AYIKW0mtYjCfqK0j44e+DRAofJSrFmWlTsLVJAUMQ2jUvSc878i++TqdDpPlff7B/cvLhYr1/Pc6+WhL1kul+4CkfYfC8uWtN1uP1Kq1cqtO9vbd7e2tnaRnUql8pNqtbqDuZ1tROZuQtaivf0dwKdy05kDYgoAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"style tag top\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-8d63b.png\\\"\\n        srcset=\\\"/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-16ce1.png 213w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-898e7.png 425w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-8d63b.png 850w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-c39de.png 1275w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-12da9.png 1700w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-894f8.png 2550w,\\n/blog/static/style-tag-top-6b7ec98c3ba3ef6280f79f6639edac1f-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    \\n<span><code class=\\\"language-text\\\">&lt;style&gt;</code>在头部，一开始就直接解析完成，没有网络请求</span></p>\\n<h4 id=\\\"设置style或者link在尾部\\\"><a href=\\\"#%E8%AE%BE%E7%BD%AEstyle%E6%88%96%E8%80%85link%E5%9C%A8%E5%B0%BE%E9%83%A8\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>设置style或者link在尾部</h4>\\n<p>先来看看设置<code class=\\\"language-text\\\">&lt;style&gt;</code>在尾部，Recalculate Style出现了1次</p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACT0lEQVQ4y5WS227TQBCGfYuElCZ9BNJbnoKrBgmJOwgXvBDmgjdBqI0oSLSQNDROcBslblBTJXZC4xwcn4+7M8y6NEKACoz06Z/dndn1en+p825/p99XXmqDgaz1+/L5+bnc1wZy+4sqt9ttWVEUudPpyKqqyn1a7/V68nA4lHVdl8fjcQ7lL0aj0atWq3Vfqu3vPVrbNvq+jzZpINQLcWW76DgOzQcYhmFOFEUYEnEcY5IkOSIXAAAeHBw8l16/2dsdfL2EyWSS6rqR6oZQPZ3S2KDcEPOGkedi3aBc6His5+Q9uh5Pp1Os1WpPpNbJSSVJIqQABAYiYSwjGKZpilmWkSY/NN0ogKhJkXMGLMuY6Ot2u1Xp8NPnij5b4+mFCd2LGbRUAwejNdpugF4QYZQwDOPsJ67H3yYBzs0YzYULlu+wpW9h87hVld5+VCvrgOPSY6DPbFCaF6gN52j5KfoxoJ8gKf6mtsfR8QGdgIEbcxbSNzbyDY/alYAaI7qFG2QgTl96GTohp0aOXnSN/4sGCeTrdCgQjNOV1bMebfj+uDK5muPKWoMfhOD59KJxilGc/CtA5P/w9PSsKilKu7JcWcIWkD/M/4foyTfUNK1Kr9zctSzhw4CTzzhtvEGMYyK6hTDMNeOcI5n/qVSvNx7arrcxqbCEsIwoEGZ2PHptMvuNkf+E6BPRaDSeSR8Ojx5cXc1Wi8VifhMivx6b85lpzk3iL0Flpluv1x9LxWLhznapeG9ra2uHKBcKhQ3FYrG8XSqVS4RYuw1RS3r3O/tudhAlEVmOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"style tag bottom\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-8d63b.png\\\"\\n        srcset=\\\"/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-16ce1.png 213w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-898e7.png 425w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-8d63b.png 850w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-c39de.png 1275w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-12da9.png 1700w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-894f8.png 2550w,\\n/blog/static/style-tag-bottom-64d9c04db783659fa9b508f6dffd0916-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p>再看设置<code class=\\\"language-text\\\">&lt;link&gt;</code>在尾部，Recalculate Style一共出现<strong>3次</strong></p>\\n<p>\\n  <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-332c0.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n  \\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 850px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 64.80446927374301%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACgUlEQVQ4y3WS2W7TQBSGfYuE1Cy8AektT8FVg4TEHQ0XvBDmggepkCpKEqktJdCG1GlSKUuJCl5bO4m3sT1eYs9hZrooEu2RPv3nnzNzPOMZQWrvbY5GvY+TiwtxPB6L0+lUHE8uxP7ZUJQkSTw9PRX7/b44GAx4fTQaiZeXl6KqqqKiKDeoygdZlj/1er0XQqv59bUfIAjDEDzPhyiiGmCwPQS+z3wEGGNOHMecJEkgTdN7mGfRbrffC7t7ra3ZH5UYupYZhpFpmkZRM516XdczleZsjClHVbjSXWWyImd/ZZlpomoaNJvNt8LwTKojukP9+orImkrm9hKWnktxwPE8cOmu73Bcj47deQTqQoaZNSEzc5JfhRoc939uCzuto/poqICmmcSwLWIsLGBoFNNFECc5hDjj+EHCNcIriOIc/AjDMvTIMvLzMHRh//NOQ9g9kOq2tgBXt8jcicjSxRDSX4IwATssgK6HMAWIbgnX1PYTcFFGAkzyxMPwvb3fEJpHUp0VURAT28fEQTFtWICPC9ow53kQP0QOlo1g7gRk4YS5H2Xwqz9oCIedH3Vz6YG5DAgKIoLjhB4z5eA4vc8fIkkzBkmzVc5ueXh+3hBOjnv137IDlpcQ17EJQghugnAIoUrIvV+H1cjNBN6QvtOG8OVA2moNHZgaURH4XhEEYUHnFCyY3kHdI/B5K9aQPvptods9eXVtB5BmOf1aAeuRZSm91YQePYYiz4Gu/Y+cjq9WvB90u913wsHht5eWadqLxXxuWdZ8PZg3TZPD8segYVJFnU7njVApl56Uy5XnpVJps1wu16jWNjY2OJVKpfasWqlVq9Uaqz0GW3ObP/0HnzVyjhMdLsEAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"link tag bottom\\\"\\n        title=\\\"\\\"\\n        src=\\\"/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-8d63b.png\\\"\\n        srcset=\\\"/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-16ce1.png 213w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-898e7.png 425w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-8d63b.png 850w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-c39de.png 1275w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-12da9.png 1700w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-894f8.png 2550w,\\n/blog/static/link-tag-bottom-744a962b04e4da669e95f7b44481c752-332c0.png 2864w\\\"\\n        sizes=\\\"(max-width: 850px) 100vw, 850px\\\"\\n      />\\n    </span>\\n  </span>\\n  \\n  </a>\\n    </p>\\n<p><strong>先总结实验结果</strong></p>\\n<p>实验中将<code class=\\\"language-text\\\">&lt;link&gt;</code>放在头部，<code class=\\\"language-text\\\">&lt;style&gt;</code>放在头部，<code class=\\\"language-text\\\">&lt;link&gt;</code>放在尾部，<code class=\\\"language-text\\\">&lt;style&gt;</code>放在尾部，<em>Recalculate Style</em>的次数分别是2，1，3，1</p>\\n<p><strong>然后我们需要了解Chrome Dev Tools Performance Tab的几个关键过程</strong></p>\\n<ol>\\n<li>Performance Tab里的<em>Recalculate Style</em>，官方是这样解释的</li>\\n</ol>\\n<blockquote>\\n<p>To find out how long the CSS processing takes you can record a timeline in DevTools and look for \\\"Recalculate Style\\\" event: unlike DOM parsing, the timeline doesn’t show a separate \\\"Parse CSS\\\" entry, and instead captures parsing and CSSOM tree construction, plus the recursive calculation of computed styles under this one event.</p>\\n</blockquote>\\n<p>在Performance Tab里面，没有看到<em>Render Tree</em>构建这一过程，这一过程也被浏览器隐藏在<em>Recalculate Style</em>里面，所以<em>Recalculate Style</em>既可能包括CSSOM的构建，也可能包括<em>Render Tree</em>的构建</p>\\n<ol start=\\\"2\\\">\\n<li>\\n<p>对于<code class=\\\"language-text\\\">&lt;style&gt;</code>里的CSS，解析过程发生在<em>Recalculate Style</em>中，而<code class=\\\"language-text\\\">&lt;link&gt;</code>获得的CSS，解析过程是单独的，叫做<em>Parse CSS</em> (和<em>Parse HTML</em>类似)</p>\\n</li>\\n<li>\\n<p>同时，要明确浏览器还有一个默认的<em>User Agent Style</em>，我们的Style只是对其进行一个覆盖</p>\\n</li>\\n</ol>\\n<p><strong>最后猜想这4个结果的原因如下</strong></p>\\n<ol>\\n<li>浏览器如果发现<code class=\\\"language-text\\\">&lt;head&gt;</code>里存在<code class=\\\"language-text\\\">&lt;link&gt;</code>，则会等待CSS网络请求完成并解析好之后才开始Render Tree，至于第一次的<em>Recalculate Style</em>，我猜想是默认的<em>User Agent Style</em>，此时CSSOM已经开始构建了，而接收到CSS文件，我们设置的Style会对默认的Style进行覆盖。这里第一次<em>Recalculate Style</em>只包含CSSOM构建，第二次则包含了CSSOM更新以及<em>Render Tree</em>构建</li>\\n<li><code class=\\\"language-text\\\">&lt;style&gt;</code>放在头部，浏览器因为可以马上拿到CSS，就可以马上进行解析，此时<em>User Agent Style</em>的解析和我们自定义的<em>Style</em>解析合并，<em>Recalculate Style</em>包含了CSSOM构建和<em>Render Tree</em>构建</li>\\n<li><code class=\\\"language-text\\\">&lt;style&gt;</code>放在尾部，和放在头部类似。只不过晚点发现CSS，但是由于是行内<code class=\\\"language-text\\\">&lt;style&gt;</code>，还是可以马上解析</li>\\n<li><code class=\\\"language-text\\\">&lt;link&gt;</code>放在尾部，浏览器一开始没发现<code class=\\\"language-text\\\">&lt;link&gt;</code>，会使用<em>User Agent Style</em>（2次 <em>Recalculate Style</em>），后面才发CSS网络请求，最后再触发CSSOM的更新（1次 <em>Recalculate Style</em>），这是最糟糕的情况。这里的3次<em>Recalculate Style</em>分别指CSSOM构建，<em>Render Tree</em>构建，CSSOM更新和<em>Render Tree</em>构建。<em>Render Tree</em>构建两次，页面发生两次渲染，为最糟糕的情况</li>\\n</ol>\\n<p>所以，我们需要将<code class=\\\"language-text\\\">&lt;style&gt;</code>和<code class=\\\"language-text\\\">&lt;link&gt;</code>放在头部，对于<code class=\\\"language-text\\\">&lt;style&gt;</code>在尾部，这个例子省略了JS的影响，如果加入JS，则结果又会不一样</p>\\n<p>本来想再测试一下JS在HTML中不同位置的影响，但是就CRP这一过程来讲，这部分比较容易叙述清楚</p>\\n<p>因为JS不管在哪个位置都会默认阻塞DOM。如果DOM尚未构建完成，JS中对不在DOM的元素进行操作，会抛出错误，脚本直接结束。如果将脚本设置为<code class=\\\"language-text\\\">async</code>，则放在前面也是OK的，例如使用<code class=\\\"language-text\\\">document.createElement</code>创建的<code class=\\\"language-text\\\">&lt;script&gt;</code>，其默认使用的就是异步</p>\\n<h2 id=\\\"总结\\\"><a href=\\\"#%E6%80%BB%E7%BB%93\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>总结</h2>\\n<p>这篇文章是我阅读了Google Developer的<a href=\\\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/\\\">Web Performance Fundamentals</a>后，自己做实践得到的总结。非常建议每位FEDers阅读这一系列文章。文章作者<a href=\\\"https://developers.google.com/web/resources/contributors/ilyagrigorik\\\">Ilya Grigorik</a>还和Udacity开设了联合课程<a href=\\\"https://classroom.udacity.com/courses/ud884\\\">Website Performance Optimization</a>以及他关于<a href=\\\"https://www.youtube.com/watch?v=PkOBnYxqj3k\\\">Web Performance的一次演讲</a>，都值得一看</p>\\n<p>由于水平有限，我只看了前半部分（关于CRP），后半部分则关于在Web Performance Optimization的实践</p>\\n<p>疏漏之处，欢迎指正</p>\\n<h2 id=\\\"参考\\\"><a href=\\\"#%E5%8F%82%E8%80%83\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>参考</h2>\\n<ol>\\n<li><a href=\\\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/\\\">https://developers.google.com/web/fundamentals/performance/critical-rendering-path/</a> (Recommended)</li>\\n<li><a href=\\\"https://classroom.udacity.com/courses/ud884\\\">Website Performance Optimization - Udacity</a></li>\\n<li><a href=\\\"https://stackoverflow.com/questions/5797014/why-do-browsers-match-css-selectors-from-right-to-left/\\\">https://stackoverflow.com/questions/5797014/why-do-browsers-match-css-selectors-from-right-to-left/</a></li>\\n<li><a href=\\\"https://www.youtube.com/watch?v=PkOBnYxqj3k\\\">https://www.youtube.com/watch?v=PkOBnYxqj3k</a></li>\\n</ol>\",\"frontmatter\":{\"title\":\"深入理解浏览器解析渲染HTML\",\"date\":\"September 20, 2018\",\"excerpt\":\"除了知道如何用代码实现一个页面之外，最重要的是明白这个页面是如何被浏览器解析和渲染，并最终呈现在我们面前的\",\"contents\":[{\"text\":\"前言\",\"subContents\":null},{\"text\":\"critical-rendering-path\",\"subContents\":null},{\"text\":\"构建dom\",\"subContents\":null},{\"text\":\"构建cssom\",\"subContents\":null},{\"text\":\"构建render-tree\",\"subContents\":[{\"text\":\"扩展：css匹配规则为何从右向左\"}]},{\"text\":\"layout\",\"subContents\":null},{\"text\":\"paint\",\"subContents\":null},{\"text\":\"引入javascript\",\"subContents\":null},{\"text\":\"使用chrome-dev-tools检测crp\",\"subContents\":[{\"text\":\"0-代码部分\"},{\"text\":\"1-不加载js情况\"},{\"text\":\"2-引入js\"},{\"text\":\"3-async-script\"},{\"text\":\"4-css在html中不同位置的影响\"}]},{\"text\":\"总结\",\"subContents\":null},{\"text\":\"参考\",\"subContents\":null}]}}},\"pathContext\":{\"slug\":\"/learning/2018/09/20/How-a-Webpage-is-Displayed/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/learning-2018-09-20-how-a-webpage-is-displayed.json\n// module id = 286\n// module chunks = 224058518057538"],"sourceRoot":""}